<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>智能轮椅辅助应用</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>♿</text></svg>">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        }
        .joystick-container {
            position: relative;
            width: 200px;
            height: 200px;
            background: rgba(0, 0, 0, 0.05);
            border-radius: 50%;
            margin: 0 auto;
        }
        .joystick {
            position: absolute;
            width: 80px;
            height: 80px;
            background: #3b82f6;
            border-radius: 50%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            cursor: pointer;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .directions {
            position: absolute;
            width: 100%;
            height: 100%;
        }
        .direction {
            position: absolute;
            width: 20px;
            height: 20px;
            color: #64748b;
        }
        .direction.up { top: 10px; left: 50%; transform: translateX(-50%); }
        .direction.right { top: 50%; right: 10px; transform: translateY(-50%); }
        .direction.down { bottom: 10px; left: 50%; transform: translateX(-50%); }
        .direction.left { top: 50%; left: 10px; transform: translateY(-50%); }
        
        .battery-level {
            width: 100%;
            height: 10px;
            background-color: #e5e7eb;
            border-radius: 5px;
            overflow: hidden;
        }
        .battery-fill {
            height: 100%;
            background-color: #10b981;
            border-radius: 5px;
        }
        
        /* 激光雷达扫描动画 */
        .pulse-animation {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        
        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: .5;
            }
        }
        
        /* 雷达扫描线样式 */
        #radar-line {
            pointer-events: none;
            opacity: 0.8;
            transition: transform 0.05s linear;
        }
        
        /* 轮椅位置动画 */
        #wheelchair-position {
            transition: all 0.1s ease-in-out;
        }
        
        /* Canvas样式 */
        #mapping-canvas {
            cursor: crosshair;
        }
        
        #mapping-canvas:not(.waypoint-mode) {
            cursor: default;
        }
        
        /* 设点模式提示动画 */
        #waypoint-mode-tip {
            animation: tipFadeIn 0.3s ease-in-out;
        }
        
        @keyframes tipFadeIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* 标记点类型按钮hover效果 */
        .waypoint-type-btn {
            transition: all 0.2s ease-in-out;
        }
        
        /* 实时标记点列表动画 */
        #realtime-waypoints-list > div {
            animation: slideInUp 0.3s ease-out;
        }
        
        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">
    <!-- 页面导航栏 -->
    <nav class="fixed bottom-0 w-full bg-white shadow-lg z-10">
        <div class="flex justify-around items-center p-2">
            <a href="#home" class="flex flex-col items-center p-2 text-blue-500">
                <i class="fas fa-home text-xl"></i>
                <span class="text-xs mt-1">首页</span>
            </a>
            <a href="#control" class="flex flex-col items-center p-2 text-gray-400">
                <i class="fas fa-gamepad text-xl"></i>
                <span class="text-xs mt-1">控制</span>
            </a>
            <a href="#voice" class="flex flex-col items-center p-2 text-gray-400">
                <i class="fas fa-microphone text-xl"></i>
                <span class="text-xs mt-1">语音</span>
            </a>
            <a href="#device" class="flex flex-col items-center p-2 text-gray-400">
                <i class="fas fa-wheelchair text-xl"></i>
                <span class="text-xs mt-1">设备</span>
            </a>
            <a href="#profile" class="flex flex-col items-center p-2 text-gray-400">
                <i class="fas fa-user text-xl"></i>
                <span class="text-xs mt-1">我的</span>
            </a>
        </div>
    </nav>

    <!-- 主要内容区域 -->
    <div class="pb-16 pt-4">
        <!-- 登录注册页面 -->
        <div id="login" class="p-4 max-w-md mx-auto">
            <div class="text-center mb-8">
                <svg class="w-20 h-20 mx-auto mb-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="10"></circle>
                    <path d="M8 14s1.5 2 4 2 4-2 4-2"></path>
                    <line x1="9" y1="9" x2="9.01" y2="9"></line>
                    <line x1="15" y1="9" x2="15.01" y2="9"></line>
                </svg>
                <h1 class="text-2xl font-bold text-blue-600">智能轮椅助手</h1>
                <p class="text-gray-500">让出行更加便捷自由</p>
            </div>
            
            <div id="register-form" class="bg-white rounded-xl shadow-md p-6 mb-4">
                <h2 class="text-xl font-semibold mb-4">账号注册</h2>
                
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-1">邮箱地址</label>
                    <div class="flex">
                        <input type="email" class="flex-1 rounded-l-lg border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="请输入邮箱">
                        <button class="bg-blue-500 text-white px-3 py-2 rounded-r-lg">获取验证码</button>
                    </div>
                </div>
                
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-1">验证码</label>
                    <input type="text" class="w-full rounded-lg border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="请输入验证码">
                </div>
                
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-1">密码</label>
                    <input type="password" class="w-full rounded-lg border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="请设置密码">
                </div>
                
                <button class="w-full bg-blue-600 text-white py-2 rounded-lg font-medium shadow-md hover:bg-blue-700 transition">注册并创建家庭圈</button>
                
                <p class="text-center text-sm text-gray-500 mt-4">
                    已有账号？<a href="#" class="text-blue-600" id="show-login-btn">立即登录</a>
                </p>
            </div>
            
            <div id="login-form" class="hidden bg-white rounded-xl shadow-md p-6 mb-4">
                <h2 class="text-xl font-semibold mb-4">账号登录</h2>
                
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-1">邮箱地址</label>
                    <input type="email" class="w-full rounded-lg border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="请输入邮箱">
                </div>
                
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-1">密码</label>
                    <div class="relative">
                        <input type="password" class="w-full rounded-lg border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="请输入密码">
                        <a href="#" class="absolute right-3 top-1/2 transform -translate-y-1/2 text-sm text-gray-500">忘记密码？</a>
                    </div>
                </div>
                
                <button class="w-full bg-blue-600 text-white py-2 rounded-lg font-medium shadow-md hover:bg-blue-700 transition">登录</button>
                
                <p class="text-center text-sm text-gray-500 mt-4">
                    没有账号？<a href="#" class="text-blue-600" id="show-register-btn">立即注册</a>
                </p>
            </div>
        </div>

        <!-- 添加设备页面 -->
        <div id="add-device" class="hidden p-4 max-w-md mx-auto">
            <div class="bg-white rounded-xl shadow-md p-6 mb-4">
                <h2 class="text-xl font-semibold mb-4">添加智能轮椅</h2>
                
                <div class="text-center py-8">
                    <div class="w-24 h-24 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-bluetooth text-blue-600 text-3xl"></i>
                    </div>
                    <p class="text-gray-700 mb-6">正在搜索附近的智能轮椅设备...</p>
                    <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"></div>
                </div>
                
                <div class="border border-gray-200 rounded-lg p-4 mb-4">
                    <div class="flex items-center">
                        <div class="bg-blue-100 rounded-full p-3 mr-3">
                            <i class="fas fa-wheelchair text-blue-600"></i>
                        </div>
                        <div class="flex-1">
                            <h3 class="font-medium">Orion-Wheelchair-A002</h3>
                            <p class="text-sm text-gray-500">智能轮椅设备</p>
                        </div>
                        <button class="bg-blue-600 text-white px-4 py-1 rounded-full text-sm" id="connect-device-btn">连接</button>
                    </div>
                </div>
                
                <p class="text-sm text-gray-500 mb-4">
                    请确保智能轮椅设备已开启并处于蓝牙配对模式
                </p>
                
                <button class="w-full border border-gray-300 text-gray-700 py-2 rounded-lg font-medium mt-4" id="refresh-devices-btn">
                    手动刷新设备列表
                </button>
            </div>
        </div>

        <!-- 配置Wi-Fi页面 -->
        <div id="wifi-setup" class="hidden p-4 max-w-md mx-auto">
            <div class="bg-white rounded-xl shadow-md p-6 mb-4">
                <h2 class="text-xl font-semibold mb-4">配置Wi-Fi</h2>
                
                <p class="text-gray-700 mb-4">
                    请为您的智能轮椅设备配置Wi-Fi连接
                </p>
                
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-1">Wi-Fi名称</label>
                    <input type="text" class="w-full rounded-lg border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="请输入Wi-Fi名称">
                </div>
                
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-1">Wi-Fi密码</label>
                    <input type="password" class="w-full rounded-lg border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="请输入Wi-Fi密码">
                </div>
                
                <button class="w-full bg-blue-600 text-white py-2 rounded-lg font-medium shadow-md hover:bg-blue-700 transition" id="confirm-wifi-btn">确认配置</button>
            </div>
        </div>

        <!-- 添加成功页面 -->
        <div id="device-success" class="hidden p-4 max-w-md mx-auto">
            <div class="bg-white rounded-xl shadow-md p-6 mb-4 text-center">
                <div class="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-check text-green-600 text-3xl"></i>
                </div>
                <h2 class="text-xl font-semibold mb-2">设备添加成功</h2>
                <p class="text-gray-700 mb-6">
                    您的智能轮椅设备已成功连接到家庭网络
                </p>
                
                <div class="border border-gray-200 rounded-lg p-4 mb-6">
                    <div class="flex items-center">
                        <div class="bg-blue-100 rounded-full p-3 mr-3">
                            <i class="fas fa-wheelchair text-blue-600"></i>
                        </div>
                        <div class="flex-1 text-left">
                            <h3 class="font-medium">Orion-Wheelchair-A002</h3>
                            <p class="text-sm text-green-600">已连接</p>
                        </div>
                    </div>
                </div>
                
                <button class="w-full bg-blue-600 text-white py-2 rounded-lg font-medium shadow-md hover:bg-blue-700 transition" id="go-to-device-status-btn">前往设备状态</button>
            </div>
        </div>

        <!-- 远程控制页面 -->
        <div id="control" class="hidden p-4 max-w-md mx-auto">
            <div class="bg-white rounded-xl shadow-md p-6 mb-4">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl font-semibold">远程控制</h2>
                    <div class="flex items-center">
                        <div class="w-3 h-3 bg-green-500 rounded-full mr-2"></div>
                        <span class="text-sm text-gray-700">已连接</span>
                    </div>
                </div>
                
                <div class="mb-8 joystick-container">
                    <div class="directions">
                        <div class="direction up"><i class="fas fa-chevron-up"></i></div>
                        <div class="direction right"><i class="fas fa-chevron-right"></i></div>
                        <div class="direction down"><i class="fas fa-chevron-down"></i></div>
                        <div class="direction left"><i class="fas fa-chevron-left"></i></div>
                    </div>
                    <div class="joystick">
                        <div class="w-full h-full rounded-full flex items-center justify-center">
                            <div class="w-4 h-4 bg-white rounded-full"></div>
                        </div>
                    </div>
                </div>
                
                <div class="mb-4">
                    <button class="w-full bg-yellow-500 text-white py-3 rounded-lg font-medium">
                        <i class="fas fa-lock mr-2"></i> 远程锁车
                    </button>
                </div>
                
                <div class="border-t border-gray-200 pt-4">
                    <h3 class="font-medium text-gray-700 mb-2">档位调节</h3>
                    <div class="relative mb-2">
                        <div class="flex justify-between mb-1">
                            <span class="text-xs text-gray-500">低速</span>
                            <span class="text-xs text-gray-500">高速</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <button class="w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center text-gray-600 focus:outline-none hover:bg-gray-300" id="decrease-level">
                                <i class="fas fa-minus"></i>
                            </button>
                            <div class="flex-1 px-4">
                                <div class="w-full h-2 bg-gray-200 rounded-full">
                                    <div class="h-full bg-blue-600 rounded-full" style="width: 60%" id="level-indicator"></div>
                                </div>
                                <div class="flex justify-between mt-1">
                                    <span class="text-xs">LV1</span>
                                    <span class="text-xs">LV2</span>
                                    <span class="text-xs font-bold text-blue-600">LV3</span>
                                    <span class="text-xs">LV4</span>
                                    <span class="text-xs">LV5</span>
                                </div>
                            </div>
                            <button class="w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center text-gray-600 focus:outline-none hover:bg-gray-300" id="increase-level">
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="bg-gray-100 rounded-lg p-3 mt-2 flex items-center justify-between">
                        <div class="flex items-center">
                            <i class="fas fa-tachometer-alt text-gray-500 mr-2"></i>
                            <span class="text-sm text-gray-700">当前车速</span>
                        </div>
                        <div class="text-lg font-bold text-blue-600" id="current-speed">2.5 km/h</div>
                    </div>
                </div>
                
                <!-- 实时视频窗口 -->
                <div class="mt-4 border-t border-gray-200 pt-4">
                    <div class="flex justify-between items-center mb-2">
                        <h3 class="font-medium text-gray-700">实时画面</h3>
                        <div class="flex items-center">
                            <div class="w-2 h-2 bg-red-500 rounded-full mr-1 pulse-animation"></div>
                            <span class="text-xs text-red-500">实时</span>
                        </div>
                    </div>
                    <div class="rounded-lg overflow-hidden relative bg-gray-900 aspect-video">
                        <div id="video-placeholder" class="flex items-center justify-center h-full">
                            <p class="text-gray-400 text-sm">正在加载视频...</p>
                        </div>
                        <video id="remote-video" class="w-full h-full object-cover" autoplay playsinline muted></video>
                        <div class="absolute bottom-2 right-2 flex">
                            <button id="toggle-fullscreen" class="bg-black bg-opacity-50 text-white rounded-full p-2 mr-2">
                                <i class="fas fa-expand"></i>
                            </button>
                            <button id="toggle-mic" class="bg-black bg-opacity-50 text-white rounded-full p-2">
                                <i class="fas fa-microphone-slash"></i>
                            </button>
                        </div>
                    </div>
                    <div class="flex justify-between items-center mt-2">
                        <div class="text-xs text-gray-500">720p | 25fps</div>
                        <div class="flex items-center">
                            <span class="text-xs text-gray-500 mr-2">画质：</span>
                            <select class="text-xs border rounded px-1 py-0.5">
                                <option>高清</option>
                                <option selected>标清</option>
                                <option>流畅</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 状态查询页面 -->
        <div id="device-status" class="hidden p-4 max-w-md mx-auto">
            <div class="flex justify-between items-center mb-4 px-2">
                <h2 class="text-xl font-semibold">智能轮椅</h2>
                <button class="text-blue-500" id="add-device-btn">
                    <i class="fas fa-plus"></i>
                </button>
            </div>
            
            <!-- 整合后的轮椅图形和信息展示区域 -->
            <div class="bg-gray-800 rounded-xl shadow-sm p-5 mb-4 text-white relative overflow-hidden">
                <div class="flex justify-between items-start mb-1">
                    <div>
                        <p class="text-xs text-gray-400">智能轮椅</p>
                        <p class="font-semibold">A001</p>
                    </div>
                    <!-- 添加查看设备详情按钮 -->
                    <button id="show-device-details-btn" class="text-gray-400 text-sm p-1">
                        <i class="fas fa-info-circle"></i>
                    </button>
                </div>
                
                <div class="flex justify-center my-6">
                    <!-- 轮椅SVG图形 -->
                    <svg width="180" height="120" viewBox="0 0 200 150" xmlns="http://www.w3.org/2000/svg" class="wheelchair-svg">
                        <!-- 轮椅主体 -->
                        <rect x="60" y="40" width="80" height="70" rx="5" fill="#444" />
                        <rect x="70" y="30" width="60" height="20" rx="5" fill="#555" />
                        
                        <!-- 左轮 -->
                        <circle cx="50" cy="100" r="30" fill="none" stroke="#777" stroke-width="8" />
                        <circle cx="50" cy="100" r="5" fill="#999" />
                        <line x1="50" y1="70" x2="50" y2="130" stroke="#777" stroke-width="2" />
                        <line x1="20" y1="100" x2="80" y2="100" stroke="#777" stroke-width="2" />
                        
                        <!-- 右轮 -->
                        <circle cx="150" cy="100" r="30" fill="none" stroke="#777" stroke-width="8" />
                        <circle cx="150" cy="100" r="5" fill="#999" />
                        <line x1="150" y1="70" x2="150" y2="130" stroke="#777" stroke-width="2" />
                        <line x1="120" y1="100" x2="180" y2="100" stroke="#777" stroke-width="2" />
                        
                        <!-- 小轮 -->
                        <circle cx="100" cy="40" r="10" fill="#666" />
                    </svg>
                </div>
                
                <!-- 状态图标 -->
                <div class="flex justify-around items-center text-center mb-3 text-xs">
                    <div>
                        <i class="fas fa-wifi text-green-500 mb-1 block"></i>
                        设备在线
                    </div>
                    <div>
                        <i class="fab fa-bluetooth-b text-green-500 mb-1 block"></i>
                        已配对
                    </div>
                    <div>
                        <i class="fas fa-lock text-gray-400 mb-1 block"></i>
                        未锁定
                    </div>
                    <div>
                        <i class="fas fa-thermometer-half text-gray-400 mb-1 block"></i>
                        正常
                    </div>
                    <div>
                        <i class="fas fa-battery-three-quarters text-green-500 mb-1 block" id="battery-icon"></i>
                        <span id="battery-percentage">85%</span>
                    </div>
                </div>
                
                <!-- 运行状态和电量展示 -->
                <div class="bg-gray-700 rounded-lg p-3 mb-3">
                    <div class="flex items-center mb-2">
                        <div class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center mr-3">
                            <i class="fas fa-wheelchair text-blue-600"></i>
                        </div>
                        <p class="text-sm flex items-center">
                            <span class="w-2 h-2 bg-green-500 rounded-full mr-2"></span>
                            运行中
                        </p>
                    </div>
                    
                    <!-- 当前速度和今日里程 -->
                    <div class="flex justify-between items-center px-2 mb-2">
                        <div class="flex items-center">
                            <i class="fas fa-tachometer-alt text-blue-400 mr-2 text-sm"></i>
                            <div>
                                <p class="text-xs text-gray-400">当前速度</p>
                                <p class="text-md font-bold text-white">2.5 km/h</p>
                            </div>
                        </div>
                        <div class="flex items-center">
                            <i class="fas fa-road text-blue-400 mr-2 text-sm"></i>
                            <div class="w-24 text-right">
                                <p class="text-xs text-gray-400">今日里程</p>
                                <p class="text-md font-bold text-white">25 km</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 预计行驶和预计可用 -->
                    <div class="flex justify-between items-center px-2 pt-2 border-t border-gray-600">
                        <div class="flex items-center">
                            <i class="fas fa-route text-blue-400 mr-2 text-sm"></i>
                            <div>
                                <p class="text-xs text-gray-400">预计行驶</p>
                                <p class="text-md font-bold text-blue-400">125 km</p>
                            </div>
                        </div>
                        <div class="flex items-center">
                            <i class="fas fa-clock text-blue-400 mr-2 text-sm"></i>
                            <div class="w-24 text-right">
                                <p class="text-xs text-gray-400">预计可用</p>
                                <p class="text-md font-bold text-blue-400">6小时30分钟</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 控制按钮 -->
                <button class="w-full bg-blue-600 text-white py-3 rounded-lg font-medium mb-2 flex items-center justify-center">
                    <i class="fas fa-gamepad mr-2"></i> 远程控制
                </button>
                <button class="w-full bg-gray-700 text-white py-3 rounded-lg font-medium mb-3 flex items-center justify-center">
                    <i class="fas fa-lock mr-2"></i> 锁车
                </button>
                
                <!-- 设备位置地图 -->
                <div class="border border-gray-600 rounded-lg p-3 bg-gray-700 mb-3">
                    <div class="flex justify-between items-center mb-2">
                        <div class="flex items-center">
                            <i class="fas fa-map-marker-alt text-red-500 mr-2"></i>
                            <span class="text-sm text-white">当前位置</span>
                        </div>
                        <button class="navigate-btn" id="navigate-btn">
                            <span>导航前往</span>
                            <i class="fas fa-chevron-right ml-1 text-xs"></i>
                        </button>
                    </div>
                    
                    <div class="relative rounded-lg overflow-hidden location-map" style="height: 150px;" id="device-location-map">
                        <!-- 地图图像 -->
                        <div class="absolute inset-0 bg-gray-800 flex justify-center items-center">
                            <!-- 地图背景（模拟） -->
                            <div class="absolute inset-0 opacity-80" style="background-image: url('https://api.mapbox.com/styles/v1/mapbox/dark-v10/static/121.4737,31.2304,15,0/350x150?access_token=pk.eyJ1IjoiZXhhbXBsZXVzZXIiLCJhIjoiY2syMDVtbDZ1MG9hdjNvcGJ2YWUzcHNmcyJ9.f1Y4y9cTZxL-tsjNk3hUbA'); background-size: cover;"></div>
                            
                            <!-- 位置标记和精度圆圈 -->
                            <div class="location-marker">
                                <!-- 精度圆圈 -->
                                <div class="accuracy-circle"></div>
                                <!-- 位置标记点 -->
                                <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-3 h-3 bg-blue-500 rounded-full"></div>
                            </div>
                            
                            <!-- 右下角放大缩小按钮 -->
                            <div class="map-controls">
                                <button class="zoom-in" id="map-zoom-in"><i class="fas fa-plus"></i></button>
                                <button class="zoom-out" id="map-zoom-out"><i class="fas fa-minus"></i></button>
                            </div>
                        </div>
                        
                        <!-- 左下角位置信息 -->
                        <div class="map-address" id="device-address">
                            上海市浦东新区张江高科技园区
                        </div>
                    </div>
                    
                    <!-- 设备信息 -->
                    <div class="flex justify-between text-xs text-gray-300 mt-2">
                        <div id="location-update-time">更新于: 10:23</div>
                        <div id="gps-accuracy">GPS精度: 5米</div>
                    </div>
                </div>
            </div>

            <!-- 设备详情模态框 -->
            <div id="device-details-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center">
                <div class="bg-white rounded-xl shadow-lg p-5 m-4 max-w-md w-full">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-semibold">设备详情</h3>
                        <button id="close-device-details-btn" class="text-gray-500">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <div>
                            <p class="text-xs text-gray-500 mb-1">设备ID</p>
                            <p class="font-medium">A001-28FC9D</p>
                        </div>
                        <div>
                            <p class="text-xs text-gray-500 mb-1">电池健康度</p>
                            <p class="font-medium">96%</p>
                        </div>
                        <div>
                            <p class="text-xs text-gray-500 mb-1">固件版本</p>
                            <p class="font-medium">V2.5.3</p>
                        </div>
                        <div>
                            <p class="text-xs text-gray-500 mb-1">上次连接</p>
                            <p class="font-medium">刚刚</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 我的页面 -->
        <div id="profile" class="hidden p-4 max-w-md mx-auto">
            <div class="bg-white rounded-xl shadow-md p-6 mb-4">
                <div class="flex items-center mb-6">
                    <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mr-4">
                        <i class="fas fa-user text-blue-600 text-2xl"></i>
                    </div>
                    <div>
                        <h2 class="text-xl font-semibold">张先生</h2>
                        <p class="text-gray-500">家庭管理员</p>
                    </div>
                </div>
                
                <div class="border-t border-gray-200 pt-4">
                    <a href="family-members.html" class="flex items-center justify-between py-3 border-b border-gray-100">
                        <div class="flex items-center">
                            <i class="fas fa-users text-gray-500 w-6"></i>
                            <span class="ml-2">家庭成员管理</span>
                        </div>
                        <i class="fas fa-chevron-right text-gray-400 text-xs"></i>
                    </a>
                    <a href="emergency-contacts.html" class="flex items-center justify-between py-3 border-b border-gray-100">
                        <div class="flex items-center">
                            <i class="fas fa-phone-alt text-gray-500 w-6"></i>
                            <span class="ml-2">紧急联系人</span>
                        </div>
                        <i class="fas fa-chevron-right text-gray-400 text-xs"></i>
                    </a>
                    <a href="#" id="map-management-btn" class="flex items-center justify-between py-3 border-b border-gray-100">
                        <div class="flex items-center">
                            <i class="fas fa-map text-gray-500 w-6"></i>
                            <span class="ml-2">地图管理</span>
                        </div>
                        <i class="fas fa-chevron-right text-gray-400 text-xs"></i>
                    </a>
                    <a href="#" class="flex items-center justify-between py-3 border-b border-gray-100">
                        <div class="flex items-center">
                            <i class="fas fa-cog text-gray-500 w-6"></i>
                            <span class="ml-2">设置</span>
                        </div>
                        <i class="fas fa-chevron-right text-gray-400 text-xs"></i>
                    </a>
                    <a href="#" class="flex items-center justify-between py-3 border-b border-gray-100">
                        <div class="flex items-center">
                            <i class="fas fa-bell text-gray-500 w-6"></i>
                            <span class="ml-2">通知设置</span>
                        </div>
                        <i class="fas fa-chevron-right text-gray-400 text-xs"></i>
                    </a>
                    <a href="#" class="flex items-center justify-between py-3 border-b border-gray-100">
                        <div class="flex items-center">
                            <i class="fas fa-shield-alt text-gray-500 w-6"></i>
                            <span class="ml-2">隐私设置</span>
                        </div>
                        <i class="fas fa-chevron-right text-gray-400 text-xs"></i>
                    </a>
                    <a href="#" class="flex items-center justify-between py-3 border-b border-gray-100">
                        <div class="flex items-center">
                            <i class="fas fa-sync text-gray-500 w-6"></i>
                            <span class="ml-2">检查更新</span>
                        </div>
                        <span class="text-xs text-red-500">有新版本</span>
                    </a>
                    <a href="#" class="flex items-center justify-between py-3">
                        <div class="flex items-center">
                            <i class="fas fa-info-circle text-gray-500 w-6"></i>
                            <span class="ml-2">关于我们</span>
                        </div>
                        <i class="fas fa-chevron-right text-gray-400 text-xs"></i>
                    </a>
                </div>
                
                <button class="w-full border border-gray-300 text-gray-700 py-2 rounded-lg font-medium mt-6">
                    退出登录
                </button>
            </div>
        </div>

        <!-- 语音交互页面 -->
        <div id="voice" class="hidden p-4 max-w-md mx-auto pb-20">
            <div class="bg-white rounded-xl shadow-md p-4 mb-4">
                <div class="flex justify-between items-center mb-4">
                    <div class="flex items-center">
                        <h2 class="text-xl font-semibold">语音助手</h2>
                        <button id="history-btn" class="ml-2 bg-gray-100 hover:bg-gray-200 p-1 rounded-full text-gray-600 transition">
                            <i class="fas fa-history text-sm"></i>
                        </button>
                    </div>
                    <div class="flex items-center">
                        <div class="w-3 h-3 bg-green-500 rounded-full mr-2 pulse-animation"></div>
                        <span class="text-sm text-gray-700">已连接</span>
                    </div>
                </div>

                <!-- 对话历史区域 -->
                <div id="conversation-container" class="h-96 overflow-y-auto mb-4 px-2">
                    <div class="space-y-4">
                        <!-- 系统消息 -->
                        <div class="flex justify-center my-2">
                            <span class="text-xs text-gray-500 bg-gray-100 px-2 py-1 rounded-full">今天 14:30</span>
                        </div>
                        
                        <!-- 助手消息 -->
                        <div class="flex items-start">
                            <div class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center mr-2 flex-shrink-0">
                                <i class="fas fa-robot text-blue-600"></i>
                            </div>
                            <div class="bg-gray-100 rounded-2xl rounded-tl-none p-3 max-w-[80%]">
                                <p class="text-sm">您好！我是您的智能轮椅语音助手。您可以和我聊天，或者询问我任何问题。</p>
                            </div>
                        </div>
                        
                        <!-- 用户消息 -->
                        <div class="flex items-start justify-end">
                            <div class="bg-blue-500 text-white rounded-2xl rounded-tr-none p-3 max-w-[80%]">
                                <p class="text-sm">你好，请告诉我现在轮椅的电量情况</p>
                            </div>
                            <div class="w-8 h-8 bg-gray-200 rounded-full flex items-center justify-center ml-2 flex-shrink-0">
                                <i class="fas fa-user text-gray-500"></i>
                            </div>
                        </div>
                        
                        <!-- 助手消息 -->
                        <div class="flex items-start">
                            <div class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center mr-2 flex-shrink-0">
                                <i class="fas fa-robot text-blue-600"></i>
                            </div>
                            <div class="bg-gray-100 rounded-2xl rounded-tl-none p-3 max-w-[80%]">
                                <p class="text-sm" id="battery-status-text">您的轮椅当前电量为85%，预计可以使用6小时30分钟，行驶距离约25公里。</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 语音控制区域 -->
                <div class="border-t border-gray-200 pt-4">
                    <div class="flex items-center">
                        <div class="relative flex-grow mr-3">
                            <input type="text" id="voice-input" class="w-full rounded-full border border-gray-300 pl-4 pr-10 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="输入消息或按住麦克风说话...">
                            <button id="send-text-btn" class="absolute right-2 top-1/2 transform -translate-y-1/2 text-blue-500 hover:text-blue-700 transition">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>
                        <button id="voice-btn" class="w-12 h-12 bg-blue-500 rounded-full flex items-center justify-center text-white shadow hover:bg-blue-600 active:bg-blue-700 transition">
                            <i class="fas fa-microphone text-xl"></i>
                        </button>
                    </div>
                    
                    <!-- 语音识别指示器 (默认隐藏) -->
                    <div id="voice-indicator" class="hidden mt-4 text-center">
                        <div class="flex justify-center mb-2">
                            <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center relative">
                                <i class="fas fa-microphone text-blue-500 text-2xl"></i>
                                <div class="absolute inset-0 border-4 border-blue-300 rounded-full animate-pulse"></div>
                                <div class="absolute inset-0 flex justify-center items-center">
                                    <div class="voice-wave">
                                        <span></span>
                                        <span></span>
                                        <span></span>
                                        <span></span>
                                        <span></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <p class="text-sm text-gray-600 font-medium">正在聆听...</p>
                        <p id="voice-text" class="text-xs text-gray-500 mt-1 italic">请开始说话</p>
                    </div>
                </div>
            </div>
            
            <!-- 常用语音指令 -->
            <div class="bg-white rounded-xl shadow-md p-4 hidden">
                <h3 class="font-medium text-gray-700 mb-3">常用语音指令</h3>
                <div class="grid grid-cols-2 gap-2">
                    <button class="voice-command-btn text-left text-sm bg-gray-100 hover:bg-gray-200 p-2 rounded-lg transition">
                        <span class="block font-medium">轮椅状态</span>
                        <span class="text-xs text-gray-500">查看电量和使用情况</span>
                    </button>
                    <button class="voice-command-btn text-left text-sm bg-gray-100 hover:bg-gray-200 p-2 rounded-lg transition">
                        <span class="block font-medium">调整速度</span>
                        <span class="text-xs text-gray-500">更改轮椅行驶速度</span>
                    </button>
                    <button class="voice-command-btn text-left text-sm bg-gray-100 hover:bg-gray-200 p-2 rounded-lg transition">
                        <span class="block font-medium">温度设置</span>
                        <span class="text-xs text-gray-500">调整座椅温度</span>
                    </button>
                    <button class="voice-command-btn text-left text-sm bg-gray-100 hover:bg-gray-200 p-2 rounded-lg transition">
                        <span class="block font-medium">寻找轮椅</span>
                        <span class="text-xs text-gray-500">定位轮椅位置</span>
                    </button>
                </div>
                
                <!-- 新增更多语音指令 -->
                <div class="mt-3">
                    <button id="more-commands-btn" class="w-full text-blue-500 text-sm flex items-center justify-center py-1">
                        <span>更多指令</span>
                        <i class="fas fa-chevron-down ml-1"></i>
                    </button>
                    
                    <div id="more-commands" class="hidden mt-2 grid grid-cols-2 gap-2">
                        <button class="voice-command-btn text-left text-sm bg-gray-100 hover:bg-gray-200 p-2 rounded-lg transition">
                            <span class="block font-medium">紧急呼叫</span>
                            <span class="text-xs text-gray-500">联系紧急联系人</span>
                        </button>
                        <button class="voice-command-btn text-left text-sm bg-gray-100 hover:bg-gray-200 p-2 rounded-lg transition">
                            <span class="block font-medium">锁定轮椅</span>
                            <span class="text-xs text-gray-500">远程锁定车轮</span>
                        </button>
                        <button class="voice-command-btn text-left text-sm bg-gray-100 hover:bg-gray-200 p-2 rounded-lg transition">
                            <span class="block font-medium">语音导航</span>
                            <span class="text-xs text-gray-500">启动导航系统</span>
                        </button>
                        <button class="voice-command-btn text-left text-sm bg-gray-100 hover:bg-gray-200 p-2 rounded-lg transition">
                            <span class="block font-medium">播放音乐</span>
                            <span class="text-xs text-gray-500">控制轮椅音频系统</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 历史对话查询弹窗 -->
        <div id="history-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center">
            <div class="bg-white rounded-xl shadow-lg p-4 m-4 max-w-md w-full">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-semibold">历史对话记录</h3>
                    <button id="close-history-btn" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <div class="mb-4">
                    <div class="flex items-center justify-between mb-3">
                        <div class="relative flex-grow">
                            <input type="text" class="w-full border border-gray-300 rounded-lg px-3 py-2 pr-10" placeholder="搜索历史对话...">
                            <button class="absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-400">
                                <i class="fas fa-search"></i>
                            </button>
                        </div>
                        <button class="ml-2 text-blue-500 text-sm">
                            筛选
                        </button>
                    </div>
                    
                    <!-- 日期分组 -->
                    <div class="border-b border-gray-200 pb-2 mb-3">
                        <p class="text-xs text-gray-500 mb-2">今天</p>
                        
                        <!-- 对话项目 -->
                        <div class="bg-gray-50 hover:bg-gray-100 rounded-lg p-2 mb-2 cursor-pointer">
                            <div class="flex justify-between items-start mb-1">
                                <p class="text-sm font-medium truncate">轮椅电量查询</p>
                                <span class="text-xs text-gray-500">14:30</span>
                            </div>
                            <p class="text-xs text-gray-500 truncate" id="battery-history-text">您的轮椅当前电量为85%，预计可以使用6小时30分钟，行驶距离约25公里。</p>
                        </div>
                        
                        <div class="bg-gray-50 hover:bg-gray-100 rounded-lg p-2 mb-2 cursor-pointer">
                            <div class="flex justify-between items-start mb-1">
                                <p class="text-sm font-medium truncate">速度调整</p>
                                <span class="text-xs text-gray-500">11:15</span>
                            </div>
                            <p class="text-xs text-gray-500 truncate">已将速度调整为3档，当前速度2.5km/h。您可以通过语音指令或控制面板随时调整速度。</p>
                        </div>
                    </div>
                    
                    <!-- 更多日期分组 -->
                    <div class="border-b border-gray-200 pb-2 mb-3">
                        <p class="text-xs text-gray-500 mb-2">昨天</p>
                        
                        <div class="bg-gray-50 hover:bg-gray-100 rounded-lg p-2 mb-2 cursor-pointer">
                            <div class="flex justify-between items-start mb-1">
                                <p class="text-sm font-medium truncate">寻找轮椅</p>
                                <span class="text-xs text-gray-500">18:42</span>
                            </div>
                            <p class="text-xs text-gray-500 truncate">您的轮椅当前位置位于家中客厅区域。已在地图上标记位置并可导航前往。</p>
                        </div>
                        
                        <div class="bg-gray-50 hover:bg-gray-100 rounded-lg p-2 cursor-pointer">
                            <div class="flex justify-between items-start mb-1">
                                <p class="text-sm font-medium truncate">温度调节</p>
                                <span class="text-xs text-gray-500">09:20</span>
                            </div>
                            <p class="text-xs text-gray-500 truncate">座椅温度已设置为26℃，已切换到舒适模式。您可以随时调整温度或更改加热模式。</p>
                        </div>
                    </div>
                </div>
                
                <div class="flex justify-between">
                    <button class="text-sm text-gray-500">导出对话</button>
                    <button class="text-sm text-gray-500">清除历史</button>
                </div>
            </div>
        </div>

        <!-- 地图管理页面 -->
        <div id="map-management" class="hidden p-4 max-w-md mx-auto">
            <div class="flex items-center mb-4">
                <button id="map-management-back-btn" class="mr-3 text-gray-600">
                    <i class="fas fa-arrow-left text-lg"></i>
                </button>
                <h2 class="text-xl font-semibold">地图管理</h2>
            </div>
            
            <!-- 已有地图列表 -->
            <div class="bg-white rounded-xl shadow-md p-4 mb-4">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="font-semibold text-gray-800">我的地图</h3>
                    <span class="text-sm text-gray-500">共2个</span>
                </div>
                
                <!-- 地图项目 -->
                <div class="space-y-3">
                    <div class="border border-gray-200 rounded-lg p-3">
                        <div class="flex items-center justify-between mb-2">
                            <div class="flex items-center">
                                <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center mr-3">
                                    <i class="fas fa-home text-blue-600"></i>
                                </div>
                                <div>
                                    <h4 class="font-medium">家庭地图</h4>
                                    <p class="text-sm text-gray-500">创建于 2024-01-15</p>
                                </div>
                            </div>
                            <div class="flex items-center space-x-2">
                                <span class="text-xs bg-green-100 text-green-600 px-2 py-1 rounded-full">已启用</span>
                                <button class="text-gray-400">
                                    <i class="fas fa-ellipsis-v"></i>
                                </button>
                            </div>
                        </div>
                        <div class="text-xs text-gray-500 flex items-center justify-between">
                            <span>面积: 120㎡</span>
                            <span>充电桩: 1个</span>
                            <span>停靠点: 3个</span>
                        </div>
                    </div>
                    
                    <div class="border border-gray-200 rounded-lg p-3">
                        <div class="flex items-center justify-between mb-2">
                            <div class="flex items-center">
                                <div class="w-12 h-12 bg-gray-100 rounded-lg flex items-center justify-center mr-3">
                                    <i class="fas fa-building text-gray-600"></i>
                                </div>
                                <div>
                                    <h4 class="font-medium">办公室地图</h4>
                                    <p class="text-sm text-gray-500">创建于 2024-01-10</p>
                                </div>
                            </div>
                            <div class="flex items-center space-x-2">
                                <span class="text-xs bg-gray-100 text-gray-600 px-2 py-1 rounded-full">未启用</span>
                                <button class="text-gray-400">
                                    <i class="fas fa-ellipsis-v"></i>
                                </button>
                            </div>
                        </div>
                        <div class="text-xs text-gray-500 flex items-center justify-between">
                            <span>面积: 80㎡</span>
                            <span>充电桩: 1个</span>
                            <span>停靠点: 2个</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 新建地图按钮 -->
            <button id="create-new-map-btn" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-3 rounded-xl font-medium flex items-center justify-center mb-4">
                <i class="fas fa-plus mr-2"></i>
                新建地图
            </button>
            
            <!-- 帮助说明 -->
            <div class="bg-blue-50 rounded-xl p-4">
                <div class="flex items-start">
                    <i class="fas fa-info-circle text-blue-600 mt-1 mr-3"></i>
                    <div>
                        <h4 class="font-medium text-blue-800 mb-1">建图小贴士</h4>
                        <p class="text-sm text-blue-700">
                            建图需在室内环境进行，避免阳光直射和反光镜面。建议建图时间控制在30分钟内完成，确保传感器能够准确扫描环境。
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- 新建地图 - 连接检查页面 -->
        <div id="create-map-check" class="hidden p-4 max-w-md mx-auto">
            <div class="flex items-center mb-4">
                <button id="create-map-check-back-btn" class="mr-3 text-gray-600">
                    <i class="fas fa-arrow-left text-lg"></i>
                </button>
                <h2 class="text-xl font-semibold">新建地图</h2>
            </div>
            
            <!-- 进度指示器 -->
            <div class="mb-6">
                <div class="flex items-center">
                    <div class="w-8 h-8 bg-blue-600 text-white rounded-full flex items-center justify-center text-sm font-medium">1</div>
                    <div class="flex-1 h-0.5 bg-gray-300 mx-2"></div>
                    <div class="w-8 h-8 bg-gray-300 text-gray-500 rounded-full flex items-center justify-center text-sm">2</div>
                    <div class="flex-1 h-0.5 bg-gray-300 mx-2"></div>
                    <div class="w-8 h-8 bg-gray-300 text-gray-500 rounded-full flex items-center justify-center text-sm">3</div>
                </div>
                <div class="flex justify-between mt-2 text-xs text-gray-500">
                    <span>连接检查</span>
                    <span>配置信息</span>
                    <span>开始建图</span>
                </div>
            </div>
            
            <div class="bg-white rounded-xl shadow-md p-6 mb-4">
                <h3 class="text-lg font-semibold mb-4 text-center">连接状态检查</h3>
                
                <!-- 蓝牙连接检查 -->
                <div class="space-y-4">
                    <div class="flex items-center justify-between p-4 border border-gray-200 rounded-lg">
                        <div class="flex items-center">
                            <div class="w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center mr-3">
                                <i class="fab fa-bluetooth-b text-blue-600"></i>
                            </div>
                            <div>
                                <h4 class="font-medium">蓝牙连接</h4>
                                <p class="text-sm text-gray-500">检查与轮椅的蓝牙连接状态</p>
                            </div>
                        </div>
                        <div class="flex items-center">
                            <div id="bluetooth-status" class="w-6 h-6 bg-green-500 rounded-full flex items-center justify-center">
                                <i class="fas fa-check text-white text-sm"></i>
                            </div>
                        </div>
                    </div>
                    
                    <!-- WiFi连接检查 -->
                    <div class="flex items-center justify-between p-4 border border-gray-200 rounded-lg">
                        <div class="flex items-center">
                            <div class="w-10 h-10 bg-green-100 rounded-full flex items-center justify-center mr-3">
                                <i class="fas fa-wifi text-green-600"></i>
                            </div>
                            <div>
                                <h4 class="font-medium">网络连接</h4>
                                <p class="text-sm text-gray-500">检查轮椅的网络连接状态</p>
                            </div>
                        </div>
                        <div class="flex items-center">
                            <div id="wifi-status" class="w-6 h-6 bg-yellow-500 rounded-full flex items-center justify-center">
                                <div class="w-3 h-3 border-2 border-white border-t-transparent rounded-full animate-spin"></div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 传感器检查 -->
                    <div class="flex items-center justify-between p-4 border border-gray-200 rounded-lg">
                        <div class="flex items-center">
                            <div class="w-10 h-10 bg-purple-100 rounded-full flex items-center justify-center mr-3">
                                <i class="fas fa-satellite-dish text-purple-600"></i>
                            </div>
                            <div>
                                <h4 class="font-medium">传感器检查</h4>
                                <p class="text-sm text-gray-500">检查雷达和传感器工作状态</p>
                            </div>
                        </div>
                        <div class="flex items-center">
                            <div id="sensor-status" class="w-6 h-6 bg-gray-300 rounded-full flex items-center justify-center">
                                <div class="w-2 h-2 bg-gray-500 rounded-full"></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 连接状态说明 -->
                <!-- <div class="mt-6 p-4 bg-gray-50 rounded-lg">
                    <div class="flex items-start">
                        <i class="fas fa-info-circle text-gray-500 mt-1 mr-2"></i>
                        <div class="text-sm text-gray-600">
                            <p class="mb-1">正在检查各项连接状态...</p>
                            <p class="text-xs">• 蓝牙连接用于基础控制和状态同步</p>
                            <p class="text-xs">• 网络连接用于实时数据传输和云端同步</p>
                            <p class="text-xs">• 传感器用于环境感知和地图构建</p>
                        </div>
                    </div>
                </div> -->
            </div>
            
            <button id="connection-next-btn" class="w-full bg-gray-400 text-white py-3 rounded-xl font-medium cursor-not-allowed" disabled>
                检查中...
            </button>
        </div>

        <!-- 地图命名页面 -->
        <div id="map-naming" class="hidden p-4 max-w-md mx-auto">
            <div class="flex items-center mb-4">
                <button id="map-naming-back-btn" class="mr-3 text-gray-600">
                    <i class="fas fa-arrow-left text-lg"></i>
                </button>
                <h2 class="text-xl font-semibold">新建地图</h2>
            </div>
            
            <!-- 进度指示器 -->
            <div class="mb-6">
                <div class="flex items-center">
                    <div class="w-8 h-8 bg-blue-600 text-white rounded-full flex items-center justify-center text-sm font-medium">✓</div>
                    <div class="flex-1 h-0.5 bg-blue-600 mx-2"></div>
                    <div class="w-8 h-8 bg-blue-600 text-white rounded-full flex items-center justify-center text-sm font-medium">2</div>
                    <div class="flex-1 h-0.5 bg-gray-300 mx-2"></div>
                    <div class="w-8 h-8 bg-gray-300 text-gray-500 rounded-full flex items-center justify-center text-sm">3</div>
                </div>
                <div class="flex justify-between mt-2 text-xs text-gray-500">
                    <span>连接检查</span>
                    <span>配置信息</span>
                    <span>开始建图</span>
                </div>
            </div>
            
            <div class="bg-white rounded-xl shadow-md p-6 mb-4">
                <h3 class="text-lg font-semibold mb-6 text-center">配置地图信息</h3>
                
                <!-- 地图命名 -->
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-2">地图名称</label>
                    <input type="text" id="map-name-input" class="w-full rounded-lg border border-gray-300 px-4 py-3 focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="请输入地图名称，如：家庭地图、办公室地图">
                    <p class="text-xs text-gray-500 mt-1">建议使用具有标识性的名称，方便后续管理</p>
                </div>
                

                
                <!-- 预估面积 -->
                <!-- <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-2">预估面积</label>
                    <div class="flex items-center space-x-3">
                        <input type="range" id="area-slider" class="flex-1" min="20" max="500" value="100">
                        <span id="area-value" class="text-lg font-semibold text-blue-600 w-16">100㎡</span>
                    </div>
                    <div class="flex justify-between text-xs text-gray-500 mt-1">
                        <span>20㎡</span>
                        <span>500㎡</span>
                    </div>
                </div> -->
                
                <!-- 建图说明 -->
                <div class="bg-yellow-50 rounded-lg p-4">
                    <div class="flex items-start">
                        <i class="fas fa-lightbulb text-yellow-600 mt-1 mr-2"></i>
                        <div class="text-sm text-yellow-700">
                            <p class="font-medium mb-1">建图小提示</p>
                            <p class="text-xs">建图过程中请缓慢移动轮椅，确保传感器能够准确扫描环境。建议建图时间控制在30分钟内完成。</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <button id="naming-next-btn" class="w-full bg-gray-400 text-white py-3 rounded-xl font-medium cursor-not-allowed" disabled>
                下一步
            </button>
        </div>

        <!-- 环境检测页面 -->
        <div id="environment-check" class="hidden p-4 max-w-md mx-auto">
            <div class="flex items-center mb-4">
                <button id="environment-check-back-btn" class="mr-3 text-gray-600">
                    <i class="fas fa-arrow-left text-lg"></i>
                </button>
                <h2 class="text-xl font-semibold">环境检测</h2>
            </div>
            
            <!-- 进度指示器 -->
            <div class="mb-6">
                <div class="flex items-center">
                    <div class="w-8 h-8 bg-blue-600 text-white rounded-full flex items-center justify-center text-sm font-medium">✓</div>
                    <div class="flex-1 h-0.5 bg-blue-600 mx-2"></div>
                    <div class="w-8 h-8 bg-blue-600 text-white rounded-full flex items-center justify-center text-sm font-medium">✓</div>
                    <div class="flex-1 h-0.5 bg-blue-600 mx-2"></div>
                    <div class="w-8 h-8 bg-blue-600 text-white rounded-full flex items-center justify-center text-sm font-medium">3</div>
                </div>
                <div class="flex justify-between mt-2 text-xs text-gray-500">
                    <span>连接检查</span>
                    <span>配置信息</span>
                    <span>开始建图</span>
                </div>
            </div>
            
            <div class="bg-white rounded-xl shadow-md p-6 mb-4">
                <h3 class="text-lg font-semibold mb-6 text-center">请确认建图环境条件</h3>
                
                <!-- 手动确认（主要部分） -->
                <div class="border border-blue-200 rounded-lg p-5 mb-6 bg-blue-50">
                    <h4 class="font-semibold text-blue-800 mb-4 flex items-center">
                        <i class="fas fa-check-circle mr-2"></i>
                        环境确认清单
                    </h4>
                    <div class="space-y-4">
                        <label class="flex items-center">
                            <input type="checkbox" class="form-checkbox h-5 w-5 text-blue-600 rounded" id="indoor-confirm">
                            <span class="ml-3 text-sm font-medium">我确认当前处于室内环境</span>
                        </label>
                        <label class="flex items-center">
                            <input type="checkbox" class="form-checkbox h-5 w-5 text-blue-600 rounded" id="space-confirm">
                            <span class="ml-3 text-sm font-medium">确认轮椅有足够的活动空间</span>
                        </label>
                        <label class="flex items-center">
                            <input type="checkbox" class="form-checkbox h-5 w-5 text-blue-600 rounded" id="obstacle-confirm">
                            <span class="ml-3 text-sm font-medium">已清理主要通道上的障碍物</span>
                        </label>
                        <label class="flex items-center">
                            <input type="checkbox" class="form-checkbox h-5 w-5 text-blue-600 rounded" id="safety-confirm">
                            <span class="ml-3 text-sm font-medium">环境安全，无危险区域</span>
                        </label>
                    </div>
                </div>
                
                <!-- 环境检测结果（辅助信息） -->
                <div class="mb-4">
                    <h4 class="font-medium text-gray-700 mb-3 flex items-center">
                        <i class="fas fa-robot mr-2"></i>
                        系统自动检测（参考）
                    </h4>
                    <div class="space-y-3" id="environment-detection-results">
                        <!-- 默认显示室内环境良好 -->
                        <div class="flex items-center justify-between p-3 bg-green-50 border border-green-200 rounded-lg">
                            <div class="flex items-center">
                                <i class="fas fa-home text-green-600 text-lg mr-3"></i>
                                <div>
                                    <h5 class="font-medium text-green-800">室内环境</h5>
                                    <p class="text-xs text-green-600">检测到适合建图的室内环境</p>
                                </div>
                            </div>
                            <i class="fas fa-check text-green-600"></i>
                        </div>
                        
                        <div class="flex items-center justify-between p-3 bg-green-50 border border-green-200 rounded-lg">
                            <div class="flex items-center">
                                <i class="fas fa-sun text-green-600 text-lg mr-3"></i>
                                <div>
                                    <h5 class="font-medium text-green-800">光线条件</h5>
                                    <p class="text-xs text-green-600">光线适中，无强烈反射</p>
                                </div>
                            </div>
                            <i class="fas fa-check text-green-600"></i>
                        </div>
                        
                        <div class="flex items-center justify-between p-3 bg-yellow-50 border border-yellow-200 rounded-lg">
                            <div class="flex items-center">
                                <i class="fas fa-volume-down text-yellow-600 text-lg mr-3"></i>
                                <div>
                                    <h5 class="font-medium text-yellow-800">环境噪音</h5>
                                    <p class="text-xs text-yellow-600">环境较为安静，建议降低行驶速度</p>
                                </div>
                            </div>
                            <i class="fas fa-exclamation-triangle text-yellow-600"></i>
                        </div>
                    </div>
                    
                    <!-- 非室内环境警告（默认隐藏，检测到时显示） -->
                    <div id="outdoor-warning" class="hidden mt-4 p-4 bg-red-50 border-2 border-red-200 rounded-lg">
                        <div class="flex items-start">
                            <i class="fas fa-exclamation-triangle text-red-600 text-xl mr-3 mt-1"></i>
                            <div>
                                <h5 class="font-semibold text-red-800 mb-2">⚠️ 检测到可能的非室内环境</h5>
                                <p class="text-sm text-red-700 mb-2">
                                    系统检测到当前环境可能不适合建图，请确认您是否在室内环境中。
                                </p>
                                <div class="text-xs text-red-600 space-y-1">
                                    <p>• 建图功能设计用于室内环境</p>
                                    <p>• 室外环境可能影响传感器精度</p>
                                    <p>• 强烈建议在室内进行建图操作</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 重要提醒 -->
                <!-- <div class="bg-red-50 rounded-lg p-4">
                    <div class="flex items-start">
                        <i class="fas fa-exclamation-triangle text-red-600 mt-1 mr-2"></i>
                        <div class="text-sm text-red-700">
                            <p class="font-medium mb-1">重要提醒</p>
                            <p class="text-xs">建图过程中轮椅将自主移动，请确保：</p>
                            <ul class="text-xs mt-2 space-y-1 ml-4">
                                <li>• 周围没有人员或宠物</li>
                                <li>• 地面平整，无积水或杂物</li>
                                <li>• 您能够随时通过遥控器停止轮椅</li>
                            </ul>
                        </div>
                    </div>
                </div> -->
            </div>
            
            <button id="environment-next-btn" class="w-full bg-gray-400 text-white py-3 rounded-xl font-medium cursor-not-allowed" disabled>
                环境检测通过，继续
            </button>
        </div>

        <!-- 建图注意事项页面 -->
        <div id="mapping-precautions" class="hidden p-4 max-w-md mx-auto">
            <div class="flex items-center mb-4">
                <button id="precautions-back-btn" class="mr-3 text-gray-600">
                    <i class="fas fa-arrow-left text-lg"></i>
                </button>
                <h2 class="text-xl font-semibold">建图须知</h2>
            </div>
            
            <div class="bg-white rounded-xl shadow-md p-6 mb-4">
                <div class="text-center mb-6">
                    <div class="w-20 h-20 bg-orange-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-exclamation-triangle text-orange-600 text-3xl"></i>
                    </div>
                    <h3 class="text-lg font-semibold text-gray-800">建图前请仔细阅读以下内容</h3>
                    <p class="text-sm text-gray-600 mt-2">请您仔细阅读，并在最后勾选确认。</p>
                </div>
                
                <!-- 建图须知详细内容 -->
                <div class="space-y-4 mb-6">
                    <div class="flex items-start p-4 border border-blue-200 rounded-lg bg-blue-50">
                        <i class="fas fa-battery-three-quarters text-blue-600 text-lg mt-1 mr-3"></i>
                        <div>
                            <h4 class="font-medium text-blue-800 mb-1">1. 确保电量充足，控制建图时间</h4>
                            <p class="text-sm text-blue-700">请确认轮椅电量在50%以上。<br>整个建图过程建议控制在30分钟以内，以确保顺利完成。</p>
                        </div>
                    </div>
                    
                    <div class="flex items-start p-4 border border-green-200 rounded-lg bg-green-50">
                        <i class="fas fa-wheelchair text-green-600 text-lg mt-1 mr-3"></i>
                        <div>
                            <h4 class="font-medium text-green-800 mb-1">2. 请坐在轮椅上操作</h4>
                            <p class="text-sm text-green-700">建图时，请坐在轮椅上操控摇杆控制方向和移动。这样记录的路线更准确，也更符合您平时的使用习惯。</p>
                        </div>
                    </div>
                    
                    <div class="flex items-start p-4 border border-orange-200 rounded-lg bg-orange-50">
                        <i class="fas fa-broom text-orange-600 text-lg mt-1 mr-3"></i>
                        <div>
                            <h4 class="font-medium text-orange-800 mb-1">3. 清理路线上的障碍物</h4>
                            <p class="text-sm text-orange-700">请先把轮椅行驶路径上的杂物（比如小凳子、地垫、玩具等）清理干净。<br>建图过程中，请保持路径畅通，避免轮椅刮擦或碰撞家具。</p>
                        </div>
                    </div>
                    
                    <div class="flex items-start p-4 border border-purple-200 rounded-lg bg-purple-50">
                        <i class="fas fa-sync-alt text-purple-600 text-lg mt-1 mr-3"></i>
                        <div>
                            <h4 class="font-medium text-purple-800 mb-1">4. 路线需要走成一圈</h4>
                            <p class="text-sm text-purple-700">建图时，请从充电桩前出发，最后也回到同一个充电桩前的位置，才能完成建图。路线需闭合成一个圈。</p>
                        </div>
                    </div>
                    
                    <div class="flex items-start p-4 border border-teal-200 rounded-lg bg-teal-50">
                        <i class="fas fa-route text-teal-600 text-lg mt-1 mr-3"></i>
                        <div>
                            <h4 class="font-medium text-teal-800 mb-1">5. 只需走常用路线</h4>
                            <p class="text-sm text-teal-700">您只需要让轮椅走一遍平时经常走的路线，比如卧室到客厅、客厅到卫生间等。这些路线会变成轮椅自动行驶时的参考路线。</p>
                        </div>
                    </div>
                    
                    <div class="flex items-start p-4 border border-indigo-200 rounded-lg bg-indigo-50">
                        <i class="fas fa-map-marker-alt text-indigo-600 text-lg mt-1 mr-3"></i>
                        <div>
                            <h4 class="font-medium text-indigo-800 mb-1">6. 设置上下轮椅的"停靠点"</h4>
                            <p class="text-sm text-indigo-700">如果有固定的上下轮椅位置（比如床边、沙发边），请在这些地方设置停靠点，方便日后自动停靠。</p>
                        </div>
                    </div>
                    
                    <div class="flex items-start p-4 border border-yellow-200 rounded-lg bg-yellow-50">
                        <i class="fas fa-shield-alt text-yellow-600 text-lg mt-1 mr-3"></i>
                        <div>
                            <h4 class="font-medium text-yellow-800 mb-1">7. 停靠点附近请保持安全</h4>
                            <p class="text-sm text-yellow-700">在这些停靠点附近，请避免放置容易刮蹭的家具或有突出物体，也不要靠近楼梯、台阶等容易跌落的区域。</p>
                        </div>
                    </div>
                    
                    <div class="flex items-start p-4 border border-red-200 rounded-lg bg-red-50">
                        <i class="fas fa-arrow-up text-red-600 text-lg mt-1 mr-3"></i>
                        <div>
                            <h4 class="font-medium text-red-800 mb-1">8. 避免长时间倒退行驶</h4>
                            <p class="text-sm text-red-700">建图时请尽量保持向前行驶，不要长时间倒着走。这样可以提高轮椅导航的准确性。</p>
                        </div>
                    </div>
                </div>
                
                <!-- 风险确认 -->
                <div class="border border-gray-200 rounded-lg p-4 mb-4">
                    <h4 class="font-medium text-gray-800 mb-3">风险确认</h4>
                    <div class="space-y-3">
                        <label class="flex items-start">
                            <input type="checkbox" class="form-checkbox h-4 w-4 text-blue-600 rounded mt-0.5" id="safety-risk-confirm">
                            <span class="ml-2 text-sm">我已了解建图过程中的安全风险，并承诺在轮椅移动期间保持监督</span>
                        </label>
                        <label class="flex items-start">
                            <input type="checkbox" class="form-checkbox h-4 w-4 text-blue-600 rounded mt-0.5" id="environment-risk-confirm">
                            <span class="ml-2 text-sm">我确认建图环境安全，没有易碎物品或危险区域</span>
                        </label>
                        <label class="flex items-start">
                            <input type="checkbox" class="form-checkbox h-4 w-4 text-blue-600 rounded mt-0.5" id="responsibility-confirm">
                            <span class="ml-2 text-sm">我了解并接受因违反操作指南可能造成的风险和责任</span>
                        </label>
                    </div>
                </div>
                
                <!-- 紧急停止提醒 -->
                <!-- <div class="bg-red-100 rounded-lg p-4">
                    <div class="flex items-center mb-2">
                        <i class="fas fa-hand-paper text-red-600 mr-2"></i>
                        <h4 class="font-medium text-red-800">紧急停止</h4>
                    </div>
                    <p class="text-sm text-red-700">
                        如遇紧急情况，可通过以下方式立即停止轮椅：
                    </p>
                    <ul class="text-sm text-red-700 mt-2 ml-4">
                        <li>• 点击APP上的"紧急停止"按钮</li>
                        <li>• 按住轮椅遥控器的停止键</li>
                        <li>• 语音指令："停止轮椅"</li>
                    </ul>
                </div> -->
            </div>
            
            <button id="precautions-next-btn" class="w-full bg-gray-400 text-white py-3 rounded-xl font-medium cursor-not-allowed" disabled>
                我已阅读并同意，开始建图
            </button>
        </div>

        <!-- 设置回充点页面 -->
        <div id="set-charging-home" class="hidden p-4 max-w-md mx-auto">
            <div class="flex items-center mb-4">
                <button id="charging-home-back-btn" class="mr-3 text-gray-600">
                    <i class="fas fa-arrow-left text-lg"></i>
                </button>
                <h2 class="text-xl font-semibold">设置回充点</h2>
            </div>
            
            <div class="bg-white rounded-xl shadow-md p-6 mb-4">
                <div class="text-center mb-6">
                    <div class="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-charging-station text-green-600 text-3xl"></i>
                    </div>
                    <h3 class="text-lg font-semibold text-gray-800">请将轮椅移动到充电桩前</h3>
                    <p class="text-sm text-gray-600 mt-2">这是建图的起始点，也是轮椅自动回充的位置</p>
                </div>
                
                <!-- 操作指导 -->
                <div class="space-y-4 mb-6">
                    <div class="flex items-start p-4 border border-blue-200 rounded-lg bg-blue-50">
                        <i class="fas fa-ruler text-blue-600 text-lg mt-1 mr-3"></i>
                        <div>
                            <h4 class="font-medium text-blue-800 mb-1">1. 距离要求</h4>
                            <p class="text-sm text-blue-700">请将轮椅停在充电桩前约1米处，不要太远或太近</p>
                        </div>
                    </div>
                    
                    <div class="flex items-start p-4 border border-green-200 rounded-lg bg-green-50">
                        <i class="fas fa-compass text-green-600 text-lg mt-1 mr-3"></i>
                        <div>
                            <h4 class="font-medium text-green-800 mb-1">2. 方向调整</h4>
                            <p class="text-sm text-green-700">轮椅尾部要正对着充电桩中心，保持直线对准</p>
                        </div>
                    </div>
                    
                    <div class="flex items-start p-4 border border-purple-200 rounded-lg bg-purple-50">
                        <i class="fas fa-camera text-purple-600 text-lg mt-1 mr-3"></i>
                        <div>
                            <h4 class="font-medium text-purple-800 mb-1">3. 位置检测</h4>
                            <p class="text-sm text-purple-700">点击下方按钮，系统将通过红外摄像头检测位置是否合适</p>
                        </div>
                    </div>
                </div>
                
                <!-- 当前状态 -->
                <div class="bg-gray-50 rounded-lg p-4 mb-4">
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-sm font-medium text-gray-700">位置检测状态</span>
                        <span class="text-sm text-gray-500" id="position-status">等待检测</span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-2">
                        <div id="position-progress" class="bg-blue-600 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                    </div>
                </div>
                
                <!-- 检测结果 -->
                <div id="detection-result" class="hidden mb-4">
                    <!-- 动态显示检测结果 -->
                </div>
            </div>
            
            <button id="detect-charging-position-btn" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-3 rounded-xl font-medium">
                设置回充点
            </button>
        </div>

        <!-- 设置建图定位点页面 -->
        <div id="set-mapping-waypoints" class="hidden p-4 max-w-md mx-auto">
            <div class="flex items-center mb-4">
                <button id="mapping-waypoints-back-btn" class="mr-3 text-gray-600">
                    <i class="fas fa-arrow-left text-lg"></i>
                </button>
                <h2 class="text-xl font-semibold">设置定位点</h2>
            </div>
            
            <div class="bg-white rounded-xl shadow-md p-6 mb-4">
                <div class="text-center mb-6">
                    <div class="w-20 h-20 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-map-marker-alt text-blue-600 text-3xl"></i>
                    </div>
                    <h3 class="text-lg font-semibold text-gray-800">设置室内定位点</h3>
                    <p class="text-sm text-gray-600 mt-2">定位点帮助轮椅在室内准确定位和重定位</p>
                </div>
                
                <!-- 建议位置 -->
                <div class="space-y-4 mb-6">
                    <div class="p-4 border border-orange-200 rounded-lg bg-orange-50">
                        <h4 class="font-medium text-orange-800 mb-2">
                            <i class="fas fa-lightbulb mr-2"></i>推荐位置
                        </h4>
                        <div class="text-sm text-orange-700 space-y-1">
                            <p>• 房门口、走廊入口等开阔地点</p>
                            <p>• 客厅中央、餐厅中央等空旷区域</p>
                            <p>• 各房间的连接通道处</p>
                        </div>
                    </div>
                </div>
                
                <!-- 已设置的定位点列表 -->
                <div class="mb-6">
                    <div class="flex justify-between items-center mb-3">
                        <h4 class="font-medium">已设置定位点</h4>
                        <span class="text-sm text-gray-500" id="mapping-waypoints-count">0个</span>
                    </div>
                    
                    <div id="mapping-waypoints-list" class="space-y-2 max-h-32 overflow-y-auto">
                        <div class="text-center text-gray-400 text-sm py-4" id="no-mapping-waypoints-tip">
                            请移动轮椅到合适位置后点击"设置定位点"
                        </div>
                    </div>
                </div>
                
                <!-- 操作按钮 -->
                <div class="flex space-x-3 mb-4">
                    <button id="add-mapping-waypoint-btn" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white py-2 rounded-lg font-medium">
                        <i class="fas fa-plus mr-2"></i>设置定位点
                    </button>
                    <button id="remove-last-waypoint-btn" class="px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg" disabled>
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
                
                <!-- 提示信息 -->
                <div class="bg-yellow-50 rounded-lg p-3">
                    <div class="flex items-start">
                        <i class="fas fa-info-circle text-yellow-600 mt-1 mr-2"></i>
                        <div class="text-sm text-yellow-700">
                            <p class="font-medium mb-1">设置提示</p>
                            <p>建议至少设置3-5个定位点，确保轮椅在各个区域都能准确定位。设置完成后点击"完成"开始建图。</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <button id="mapping-waypoints-complete-btn" class="w-full bg-gray-400 text-white py-3 rounded-xl font-medium cursor-not-allowed" disabled>
                完成定位点设置
            </button>
        </div>

        <!-- 实时建图页面 -->
        <div id="real-time-mapping" class="hidden p-4 max-w-md mx-auto">
            <div class="flex items-center justify-between mb-4">
                <div class="flex items-center">
                    <h2 class="text-xl font-semibold">实时建图</h2>
                </div>
                <div class="flex items-center">
                    <div class="w-3 h-3 bg-red-500 rounded-full mr-2 pulse-animation"></div>
                    <span class="text-sm text-red-600 font-medium">建图中</span>
                </div>
            </div>
            
            <!-- 建图进度 -->
            <!-- <div class="bg-white rounded-xl shadow-md p-4 mb-4">
                <div class="flex justify-between items-center mb-3">
                    <h3 class="font-semibold">建图进度</h3>
                    <span id="mapping-progress-text" class="text-sm text-blue-600">15%</span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-2 mb-2">
                    <div id="mapping-progress-bar" class="bg-blue-600 h-2 rounded-full" style="width: 15%"></div>
                </div>
                <div class="flex justify-between text-xs text-gray-500">
                    <span>已用时间: <span id="elapsed-time">02:35</span></span>
                    <span>预计剩余: <span id="remaining-time">12:25</span></span>
                </div>
            </div> -->
            
            <!-- 实时地图显示 -->
            <div class="bg-white rounded-xl shadow-md p-4 mb-4">
                <div class="flex justify-between items-center mb-3">
                    <h3 class="font-semibold">实时地图</h3>
                    <div class="flex items-center space-x-2">
                        <div class="px-2 py-1 bg-green-100 text-green-700 text-xs rounded-full">
                            <i class="fas fa-satellite-dish mr-1"></i>建图中
                        </div>
                        <button id="map-zoom-in" class="w-8 h-8 bg-gray-100 hover:bg-gray-200 rounded-full flex items-center justify-center">
                            <i class="fas fa-plus text-sm"></i>
                        </button>
                        <button id="map-zoom-out" class="w-8 h-8 bg-gray-100 hover:bg-gray-200 rounded-full flex items-center justify-center">
                            <i class="fas fa-minus text-sm"></i>
                        </button>
                    </div>
                </div>
                
                <!-- 地图画布 -->
                <div class="relative bg-gray-900 rounded-lg overflow-hidden" style="height: 350px;">
                    <canvas id="mapping-canvas" class="w-full h-full"></canvas>
                    
                    <!-- 激光雷达扫描线 -->
                    <div id="radar-line" class="absolute top-1/2 left-1/2 w-0.5 h-32 bg-gradient-to-t from-red-500 to-transparent transform-gpu origin-bottom" style="transform: translate(-50%, -100%) rotate(0deg);"></div>
                    
                    <!-- 轮椅位置指示器 -->
                    <div id="wheelchair-position" class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2">
                        <div class="w-4 h-4 bg-blue-500 rounded-full relative">
                            <div class="absolute inset-0 bg-blue-400 rounded-full animate-ping"></div>
                            <!-- 轮椅方向指示 -->
                            <div class="absolute top-0 left-1/2 w-0.5 h-2 bg-blue-300 transform -translate-x-1/2 -translate-y-full"></div>
                        </div>
                    </div>
                    
                    <!-- 图例 -->
                    <div class="absolute bottom-2 left-2 bg-black bg-opacity-80 rounded-lg p-2">
                        <div class="grid grid-cols-2 gap-2 text-xs text-white">
                            <div class="flex items-center"><div class="w-2 h-2 bg-gray-300 mr-1"></div>墙壁</div>
                            <div class="flex items-center"><div class="w-2 h-2 bg-blue-500 mr-1"></div>轮椅</div>
                            <div class="flex items-center"><div class="w-2 h-2 bg-green-400 mr-1"></div>可通行</div>
                            <div class="flex items-center"><div class="w-2 h-2 bg-yellow-400 mr-1"></div>路径</div>
                            <div class="flex items-center"><div class="w-2 h-2 bg-red-400 mr-1"></div>扫描</div>
                            <div class="flex items-center"><div class="w-2 h-2 bg-purple-400 mr-1"></div>标记点</div>
                        </div>
                    </div>
                    
                    <!-- 建图状态提示 -->
                    <div id="mapping-status-tip" class="absolute top-2 left-2 bg-green-500 bg-opacity-90 text-white text-xs rounded-lg p-2">
                        <i class="fas fa-route mr-1"></i>正在扫描建图...
                    </div>
                </div>
                
                <!-- 地图信息 -->
                <!-- <div class="mt-3 grid grid-cols-3 gap-4 text-center">
                    <div>
                        <p class="text-xs text-gray-500">已扫描面积</p>
                        <p class="font-semibold text-blue-600" id="scanned-area">18㎡</p>
                    </div>
                    <div>
                        <p class="text-xs text-gray-500">检测到房间</p>
                        <p class="font-semibold text-green-600" id="detected-rooms">3</p>
                    </div>
                    <div>
                        <p class="text-xs text-gray-500">障碍物</p>
                        <p class="font-semibold text-orange-600" id="obstacles-count">7</p>
                    </div>
                </div> -->
            </div>
            
            <!-- 建图统计 -->
            <div class="bg-white rounded-xl shadow-md p-4 mb-4">
                <h3 class="font-semibold mb-3">建图统计</h3>
                <div class="grid grid-cols-2 gap-4">
                    <div class="text-center">
                        <div class="text-xl font-bold text-blue-600" id="path-length">0m</div>
                        <div class="text-xs text-gray-600">导航路径</div>
                    </div>
                    <div class="text-center">
                        <div class="text-xl font-bold text-green-600" id="building-time">00:00</div>
                        <div class="text-xs text-gray-600">建图时间</div>
                    </div>
                </div>
                
                <div class="mt-3 p-2 bg-yellow-50 rounded-lg">
                    <div class="flex items-center space-x-2">
                        <div class="w-2 h-2 bg-yellow-400 rounded-full animate-pulse"></div>
                        <span class="text-xs text-yellow-700">正在记录导航路径数据...</span>
                    </div>
                </div>
            </div>
            
            <!-- 停靠点设置 -->
            <div class="bg-white rounded-xl shadow-md p-4 mb-4">
                <div class="flex justify-between items-center mb-3">
                    <h3 class="font-semibold">停靠点管理</h3>
                    <span class="text-sm text-gray-500" id="parking-spots-count">0个</span>
                </div>
                
                <div id="parking-spots-list" class="space-y-2 max-h-32 overflow-y-auto mb-4">
                    <div class="text-center text-gray-400 text-sm py-4" id="no-parking-spots-tip">
                        移动轮椅到需要停靠的位置，点击"设置停靠点"
                    </div>
                </div>
                
                <button id="add-parking-spot-btn" class="w-full bg-purple-600 hover:bg-purple-700 text-white py-2 rounded-lg font-medium">
                    <i class="fas fa-parking mr-2"></i>设置停靠点
                </button>
            </div>
            
            <!-- 建图控制 -->
            <button id="finish-mapping-btn" class="w-full bg-green-600 hover:bg-green-700 text-white py-3 rounded-xl font-medium">
                <i class="fas fa-check mr-2"></i>
                建图完成
            </button>
        </div>

        <!-- 设置充电桩页面 -->
        <div id="set-charging-station" class="hidden p-4 max-w-md mx-auto">
            <div class="flex items-center mb-4">
                <button id="charging-station-back-btn" class="mr-3 text-gray-600">
                    <i class="fas fa-arrow-left text-lg"></i>
                </button>
                <h2 class="text-xl font-semibold">设置充电桩</h2>
            </div>
            
            <!-- 步骤指示器 -->
            <div class="mb-6">
                <div class="flex items-center">
                    <div class="w-6 h-6 bg-blue-600 text-white rounded-full flex items-center justify-center text-xs">1</div>
                    <div class="flex-1 h-0.5 bg-gray-300 mx-2"></div>
                    <div class="w-6 h-6 bg-gray-300 text-gray-500 rounded-full flex items-center justify-center text-xs">2</div>
                    <div class="flex-1 h-0.5 bg-gray-300 mx-2"></div>
                    <div class="w-6 h-6 bg-gray-300 text-gray-500 rounded-full flex items-center justify-center text-xs">3</div>
                    <div class="flex-1 h-0.5 bg-gray-300 mx-2"></div>
                    <div class="w-6 h-6 bg-gray-300 text-gray-500 rounded-full flex items-center justify-center text-xs">4</div>
                </div>
                <div class="flex justify-between mt-2 text-xs text-gray-500">
                    <span>充电桩</span>
                    <span>定位点</span>
                    <span>停靠点</span>
                    <span>完成</span>
                </div>
            </div>
            
            <div class="bg-white rounded-xl shadow-md p-6 mb-4">
                <div class="text-center mb-6">
                    <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-3">
                        <i class="fas fa-charging-station text-green-600 text-2xl"></i>
                    </div>
                    <h3 class="text-lg font-semibold">设置充电桩位置</h3>
                    <p class="text-sm text-gray-600 mt-2">请在地图上标记轮椅充电桩的位置</p>
                </div>
                
                <!-- 地图区域 -->
                <div class="relative bg-gray-100 rounded-lg mb-4" style="height: 250px;">
                    <canvas id="charging-map-canvas" class="w-full h-full rounded-lg"></canvas>
                    
                    <!-- 充电桩标记 -->
                    <div id="charging-station-marker" class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 hidden">
                        <div class="w-6 h-6 bg-green-500 rounded-full flex items-center justify-center shadow-lg">
                            <i class="fas fa-plug text-white text-xs"></i>
                        </div>
                    </div>
                    
                    <!-- 操作提示 -->
                    <div class="absolute top-2 left-2 bg-black bg-opacity-70 text-white text-xs rounded-lg p-2">
                        点击地图设置充电桩位置
                    </div>
                </div>
                
                <!-- 充电桩信息 -->
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">充电桩名称</label>
                        <input type="text" id="charging-station-name" class="w-full rounded-lg border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="如：客厅充电桩" value="主充电桩">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">充电桩类型</label>
                        <select id="charging-station-type" class="w-full rounded-lg border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="standard">标准充电桩</option>
                            <option value="fast">快速充电桩</option>
                            <option value="wireless">无线充电桩</option>
                        </select>
                    </div>
                    
                    <!-- 自动充电设置 -->
                    <div class="border border-gray-200 rounded-lg p-3">
                        <h4 class="font-medium text-gray-800 mb-3">自动充电设置</h4>
                        <div class="space-y-2">
                            <label class="flex items-center">
                                <input type="checkbox" class="form-checkbox h-4 w-4 text-blue-600 rounded" id="auto-charge-low-battery" checked>
                                <span class="ml-2 text-sm">电量低于20%时自动返回充电</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" class="form-checkbox h-4 w-4 text-blue-600 rounded" id="auto-charge-schedule">
                                <span class="ml-2 text-sm">定时自动充电</span>
                            </label>
                            <div id="schedule-time" class="ml-6 hidden">
                                <input type="time" class="text-sm border rounded px-2 py-1" value="02:00">
                                <span class="text-xs text-gray-500 ml-2">每天凌晨充电</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 充电桩状态预览 -->
                <div id="charging-station-preview" class="hidden mt-4 p-3 bg-green-50 rounded-lg border border-green-200">
                    <div class="flex items-center">
                        <i class="fas fa-charging-station text-green-600 mr-3"></i>
                        <div>
                            <h4 class="font-medium text-green-800">充电桩已设置</h4>
                            <p class="text-sm text-green-600" id="charging-position-info">位置: (125, 89)</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <button id="charging-station-next-btn" class="w-full bg-gray-400 text-white py-3 rounded-xl font-medium cursor-not-allowed" disabled>
                设置定位点
            </button>
        </div>

        <!-- 设置定位点页面 -->
        <div id="set-waypoints" class="hidden p-4 max-w-md mx-auto">
            <div class="flex items-center mb-4">
                <button id="waypoints-back-btn" class="mr-3 text-gray-600">
                    <i class="fas fa-arrow-left text-lg"></i>
                </button>
                <h2 class="text-xl font-semibold">设置定位点</h2>
            </div>
            
            <!-- 步骤指示器 -->
            <div class="mb-6">
                <div class="flex items-center">
                    <div class="w-6 h-6 bg-blue-600 text-white rounded-full flex items-center justify-center text-xs">✓</div>
                    <div class="flex-1 h-0.5 bg-blue-600 mx-2"></div>
                    <div class="w-6 h-6 bg-blue-600 text-white rounded-full flex items-center justify-center text-xs">2</div>
                    <div class="flex-1 h-0.5 bg-gray-300 mx-2"></div>
                    <div class="w-6 h-6 bg-gray-300 text-gray-500 rounded-full flex items-center justify-center text-xs">3</div>
                    <div class="flex-1 h-0.5 bg-gray-300 mx-2"></div>
                    <div class="w-6 h-6 bg-gray-300 text-gray-500 rounded-full flex items-center justify-center text-xs">4</div>
                </div>
                <div class="flex justify-between mt-2 text-xs text-gray-500">
                    <span>充电桩</span>
                    <span>定位点</span>
                    <span>停靠点</span>
                    <span>完成</span>
                </div>
            </div>
            
            <div class="bg-white rounded-xl shadow-md p-6 mb-4">
                <div class="text-center mb-6">
                    <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-3">
                        <i class="fas fa-map-marker-alt text-blue-600 text-2xl"></i>
                    </div>
                    <h3 class="text-lg font-semibold">设置导航定位点</h3>
                    <p class="text-sm text-gray-600 mt-2">添加重要位置，方便快速导航</p>
                </div>
                
                <!-- 地图区域 -->
                <div class="relative bg-gray-100 rounded-lg mb-4" style="height: 250px;">
                    <canvas id="waypoints-map-canvas" class="w-full h-full rounded-lg"></canvas>
                    
                    <!-- 已设置的定位点 -->
                    <div id="waypoint-markers" class="absolute inset-0">
                        <!-- 动态添加的定位点标记 -->
                    </div>
                    
                    <!-- 操作提示 -->
                    <div class="absolute top-2 left-2 bg-black bg-opacity-70 text-white text-xs rounded-lg p-2">
                        点击地图添加定位点
                    </div>
                </div>
                
                <!-- 定位点列表 -->
                <div class="mb-4">
                    <div class="flex justify-between items-center mb-3">
                        <h4 class="font-medium">已设置定位点</h4>
                        <span class="text-sm text-gray-500" id="waypoints-count">0/8</span>
                    </div>
                    
                    <div id="waypoints-list" class="space-y-2 max-h-32 overflow-y-auto">
                        <!-- 动态生成的定位点列表 -->
                    </div>
                </div>
                
                <!-- 快速添加常用定位点 -->
                <div class="border border-gray-200 rounded-lg p-3">
                    <h4 class="font-medium text-gray-800 mb-3">快速添加</h4>
                    <div class="grid grid-cols-2 gap-2">
                        <button class="quick-waypoint-btn border border-gray-300 rounded-lg p-2 text-sm hover:border-blue-500" data-name="客厅">
                            <i class="fas fa-couch text-blue-600 mb-1"></i>
                            <p>客厅</p>
                        </button>
                        <button class="quick-waypoint-btn border border-gray-300 rounded-lg p-2 text-sm hover:border-blue-500" data-name="卧室">
                            <i class="fas fa-bed text-green-600 mb-1"></i>
                            <p>卧室</p>
                        </button>
                        <button class="quick-waypoint-btn border border-gray-300 rounded-lg p-2 text-sm hover:border-blue-500" data-name="厨房">
                            <i class="fas fa-utensils text-orange-600 mb-1"></i>
                            <p>厨房</p>
                        </button>
                        <button class="quick-waypoint-btn border border-gray-300 rounded-lg p-2 text-sm hover:border-blue-500" data-name="书房">
                            <i class="fas fa-book text-purple-600 mb-1"></i>
                            <p>书房</p>
                        </button>
                    </div>
                </div>
            </div>
            
            <button id="waypoints-next-btn" class="w-full bg-blue-600 text-white py-3 rounded-xl font-medium">
                添加停靠点
            </button>
        </div>

        <!-- 添加停靠点页面 -->
        <div id="set-parking-spots" class="hidden p-4 max-w-md mx-auto">
            <div class="flex items-center mb-4">
                <button id="parking-spots-back-btn" class="mr-3 text-gray-600">
                    <i class="fas fa-arrow-left text-lg"></i>
                </button>
                <h2 class="text-xl font-semibold">添加停靠点</h2>
            </div>
            
            <!-- 步骤指示器 -->
            <div class="mb-6">
                <div class="flex items-center">
                    <div class="w-6 h-6 bg-blue-600 text-white rounded-full flex items-center justify-center text-xs">✓</div>
                    <div class="flex-1 h-0.5 bg-blue-600 mx-2"></div>
                    <div class="w-6 h-6 bg-blue-600 text-white rounded-full flex items-center justify-center text-xs">✓</div>
                    <div class="flex-1 h-0.5 bg-blue-600 mx-2"></div>
                    <div class="w-6 h-6 bg-blue-600 text-white rounded-full flex items-center justify-center text-xs">3</div>
                    <div class="flex-1 h-0.5 bg-gray-300 mx-2"></div>
                    <div class="w-6 h-6 bg-gray-300 text-gray-500 rounded-full flex items-center justify-center text-xs">4</div>
                </div>
                <div class="flex justify-between mt-2 text-xs text-gray-500">
                    <span>充电桩</span>
                    <span>定位点</span>
                    <span>停靠点</span>
                    <span>完成</span>
                </div>
            </div>
            
            <div class="bg-white rounded-xl shadow-md p-6 mb-4">
                <div class="text-center mb-6">
                    <div class="w-16 h-16 bg-purple-100 rounded-full flex items-center justify-center mx-auto mb-3">
                        <i class="fas fa-parking text-purple-600 text-2xl"></i>
                    </div>
                    <h3 class="text-lg font-semibold">设置停靠点</h3>
                    <p class="text-sm text-gray-600 mt-2">设置轮椅的常用停靠位置</p>
                </div>
                
                <!-- 地图区域 -->
                <div class="relative bg-gray-100 rounded-lg mb-4" style="height: 250px;">
                    <canvas id="parking-spots-map-canvas" class="w-full h-full rounded-lg"></canvas>
                    
                    <!-- 停靠点标记 -->
                    <div id="parking-spots-markers" class="absolute inset-0">
                        <!-- 动态添加的停靠点标记 -->
                    </div>
                    
                    <!-- 操作提示 -->
                    <div class="absolute top-2 left-2 bg-black bg-opacity-70 text-white text-xs rounded-lg p-2">
                        点击地图添加停靠点
                    </div>
                </div>
                
                <!-- 停靠点列表 -->
                <div class="mb-4">
                    <div class="flex justify-between items-center mb-3">
                        <h4 class="font-medium">已设置停靠点</h4>
                        <span class="text-sm text-gray-500" id="parking-spots-count">0/6</span>
                    </div>
                    
                    <div id="parking-spots-list" class="space-y-2 max-h-32 overflow-y-auto">
                        <!-- 动态生成的停靠点列表 -->
                    </div>
                </div>
                
                <!-- 停靠点类型选择 -->
                <div class="border border-gray-200 rounded-lg p-3">
                    <h4 class="font-medium text-gray-800 mb-3">停靠点类型</h4>
                    <div class="grid grid-cols-3 gap-2">
                        <button class="parking-type-btn border border-gray-300 rounded-lg p-2 text-sm hover:border-purple-500" data-type="rest">
                            <i class="fas fa-chair text-purple-600 mb-1"></i>
                            <p>休息点</p>
                        </button>
                        <button class="parking-type-btn border border-gray-300 rounded-lg p-2 text-sm hover:border-purple-500" data-type="temp">
                            <i class="fas fa-clock text-orange-600 mb-1"></i>
                            <p>临时停车</p>
                        </button>
                        <button class="parking-type-btn border border-gray-300 rounded-lg p-2 text-sm hover:border-purple-500" data-type="night">
                            <i class="fas fa-moon text-blue-600 mb-1"></i>
                            <p>夜间停车</p>
                        </button>
                    </div>
                </div>
                
                <!-- 停靠设置 -->
                <div class="mt-4 space-y-3">
                    <label class="flex items-center">
                        <input type="checkbox" class="form-checkbox h-4 w-4 text-blue-600 rounded" id="auto-parking">
                        <span class="ml-2 text-sm">自动停靠（轮椅将自动对齐停靠点）</span>
                    </label>
                    <label class="flex items-center">
                        <input type="checkbox" class="form-checkbox h-4 w-4 text-blue-600 rounded" id="parking-notification">
                        <span class="ml-2 text-sm">到达停靠点时发送通知</span>
                    </label>
                </div>
            </div>
            
            <button id="parking-spots-next-btn" class="w-full bg-blue-600 text-white py-3 rounded-xl font-medium">
                设置安全区域
            </button>
        </div>

        <!-- 设置安全区域页面 -->
        <div id="set-safety-zones" class="hidden p-4 max-w-md mx-auto">
            <div class="flex items-center mb-4">
                <button id="safety-zones-back-btn" class="mr-3 text-gray-600">
                    <i class="fas fa-arrow-left text-lg"></i>
                </button>
                <h2 class="text-xl font-semibold">设置安全区域</h2>
            </div>
            
            <div class="bg-white rounded-xl shadow-md p-6 mb-4">
                <div class="text-center mb-6">
                    <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-3">
                        <i class="fas fa-shield-alt text-green-600 text-2xl"></i>
                    </div>
                    <h3 class="text-lg font-semibold">划定安全区域</h3>
                    <p class="text-sm text-gray-600 mt-2">设置轮椅的安全活动范围</p>
                </div>
                
                <!-- 地图区域 -->
                <div class="relative bg-gray-100 rounded-lg mb-4" style="height: 300px;">
                    <canvas id="safety-zones-map-canvas" class="w-full h-full rounded-lg"></canvas>
                    
                    <!-- 绘制工具提示 -->
                    <div class="absolute top-2 left-2 bg-black bg-opacity-70 text-white text-xs rounded-lg p-2">
                        <div id="drawing-mode">点击并拖拽绘制安全区域</div>
                    </div>
                    
                    <!-- 绘制工具 -->
                    <div class="absolute bottom-2 right-2 flex space-x-1">
                        <button id="draw-rectangle" class="w-8 h-8 bg-green-500 text-white rounded text-xs" title="矩形">
                            <i class="fas fa-square"></i>
                        </button>
                        <button id="draw-circle" class="w-8 h-8 bg-gray-500 text-white rounded text-xs" title="圆形">
                            <i class="fas fa-circle"></i>
                        </button>
                        <button id="clear-zones" class="w-8 h-8 bg-red-500 text-white rounded text-xs" title="清除">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
                
                <!-- 安全区域列表 -->
                <div class="mb-4">
                    <div class="flex justify-between items-center mb-3">
                        <h4 class="font-medium">已设置安全区域</h4>
                        <span class="text-sm text-gray-500" id="safety-zones-count">0个</span>
                    </div>
                    
                    <div id="safety-zones-list" class="space-y-2">
                        <!-- 动态生成的安全区域列表 -->
                    </div>
                </div>
                
                <!-- 安全设置 -->
                <div class="border border-gray-200 rounded-lg p-3">
                    <h4 class="font-medium text-gray-800 mb-3">安全设置</h4>
                    <div class="space-y-2">
                        <label class="flex items-center">
                            <input type="checkbox" class="form-checkbox h-4 w-4 text-blue-600 rounded" id="zone-boundary-alert" checked>
                            <span class="ml-2 text-sm">接近边界时警告提醒</span>
                        </label>
                        <label class="flex items-center">
                            <input type="checkbox" class="form-checkbox h-4 w-4 text-blue-600 rounded" id="auto-return-zone">
                            <span class="ml-2 text-sm">超出安全区域时自动返回</span>
                        </label>
                        <label class="flex items-center">
                            <input type="checkbox" class="form-checkbox h-4 w-4 text-blue-600 rounded" id="emergency-contact-alert">
                            <span class="ml-2 text-sm">离开安全区域时通知紧急联系人</span>
                        </label>
                    </div>
                </div>
            </div>
            
            <button id="safety-zones-next-btn" class="w-full bg-blue-600 text-white py-3 rounded-xl font-medium">
                设置禁行区
            </button>
        </div>

        <!-- 设置禁行区页面 -->
        <div id="set-restricted-zones" class="hidden p-4 max-w-md mx-auto">
            <div class="flex items-center mb-4">
                <button id="restricted-zones-back-btn" class="mr-3 text-gray-600">
                    <i class="fas fa-arrow-left text-lg"></i>
                </button>
                <h2 class="text-xl font-semibold">设置禁行区</h2>
            </div>
            
            <div class="bg-white rounded-xl shadow-md p-6 mb-4">
                <div class="text-center mb-6">
                    <div class="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-3">
                        <i class="fas fa-ban text-red-600 text-2xl"></i>
                    </div>
                    <h3 class="text-lg font-semibold">设置禁行区域</h3>
                    <p class="text-sm text-gray-600 mt-2">标记轮椅禁止进入的区域</p>
                </div>
                
                <!-- 地图区域 -->
                <div class="relative bg-gray-100 rounded-lg mb-4" style="height: 300px;">
                    <canvas id="restricted-zones-map-canvas" class="w-full h-full rounded-lg"></canvas>
                    
                    <!-- 绘制工具提示 -->
                    <div class="absolute top-2 left-2 bg-black bg-opacity-70 text-white text-xs rounded-lg p-2">
                        <div>点击并拖拽绘制禁行区域</div>
                    </div>
                    
                    <!-- 绘制工具 -->
                    <div class="absolute bottom-2 right-2 flex space-x-1">
                        <button id="draw-restricted-rectangle" class="w-8 h-8 bg-red-500 text-white rounded text-xs" title="矩形">
                            <i class="fas fa-square"></i>
                        </button>
                        <button id="draw-restricted-circle" class="w-8 h-8 bg-gray-500 text-white rounded text-xs" title="圆形">
                            <i class="fas fa-circle"></i>
                        </button>
                        <button id="clear-restricted-zones" class="w-8 h-8 bg-orange-500 text-white rounded text-xs" title="清除">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
                
                <!-- 禁行区域列表 -->
                <div class="mb-4">
                    <div class="flex justify-between items-center mb-3">
                        <h4 class="font-medium">已设置禁行区域</h4>
                        <span class="text-sm text-gray-500" id="restricted-zones-count">0个</span>
                    </div>
                    
                    <div id="restricted-zones-list" class="space-y-2">
                        <!-- 动态生成的禁行区域列表 -->
                    </div>
                </div>
                
                <!-- 快速添加常见禁行区 -->
                <div class="border border-gray-200 rounded-lg p-3 mb-4">
                    <h4 class="font-medium text-gray-800 mb-3">常见禁行区域</h4>
                    <div class="grid grid-cols-2 gap-2">
                        <button class="restricted-zone-btn border border-gray-300 rounded-lg p-2 text-sm hover:border-red-500" data-type="stairs">
                            <i class="fas fa-walking text-red-600 mb-1"></i>
                            <p>楼梯区域</p>
                        </button>
                        <button class="restricted-zone-btn border border-gray-300 rounded-lg p-2 text-sm hover:border-red-500" data-type="kitchen">
                            <i class="fas fa-utensils text-orange-600 mb-1"></i>
                            <p>厨房操作台</p>
                        </button>
                        <button class="restricted-zone-btn border border-gray-300 rounded-lg p-2 text-sm hover:border-red-500" data-type="balcony">
                            <i class="fas fa-building text-blue-600 mb-1"></i>
                            <p>阳台边缘</p>
                        </button>
                        <button class="restricted-zone-btn border border-gray-300 rounded-lg p-2 text-sm hover:border-red-500" data-type="bathroom">
                            <i class="fas fa-bath text-cyan-600 mb-1"></i>
                            <p>浴室淋浴区</p>
                        </button>
                    </div>
                </div>
                
                <!-- 禁行设置 -->
                <div class="border border-gray-200 rounded-lg p-3">
                    <h4 class="font-medium text-gray-800 mb-3">禁行设置</h4>
                    <div class="space-y-2">
                        <label class="flex items-center">
                            <input type="checkbox" class="form-checkbox h-4 w-4 text-blue-600 rounded" id="strict-boundary" checked>
                            <span class="ml-2 text-sm">严格边界检测（禁止任何部分进入）</span>
                        </label>
                        <label class="flex items-center">
                            <input type="checkbox" class="form-checkbox h-4 w-4 text-blue-600 rounded" id="approach-warning">
                            <span class="ml-2 text-sm">接近禁行区时警告</span>
                        </label>
                        <label class="flex items-center">
                            <input type="checkbox" class="form-checkbox h-4 w-4 text-blue-600 rounded" id="force-stop">
                            <span class="ml-2 text-sm">进入禁行区时强制停止</span>
                        </label>
                    </div>
                </div>
            </div>
            
            <button id="restricted-zones-next-btn" class="w-full bg-blue-600 text-white py-3 rounded-xl font-medium">
                完成建图
            </button>
        </div>

        <!-- 完成建图页面 -->
        <div id="mapping-complete" class="hidden p-4 max-w-md mx-auto">
            <div class="bg-white rounded-xl shadow-md p-6 mb-4 text-center">
                <div class="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-check text-green-600 text-3xl"></i>
                </div>
                <h2 class="text-xl font-semibold mb-2">建图完成！</h2>
                <p class="text-gray-700 mb-6">
                    恭喜您成功完成地图建立，轮椅现在可以在设定的环境中自主导航
                </p>
                
                <!-- 建图总结 -->
                <div class="text-left bg-gray-50 rounded-lg p-4 mb-6">
                    <h3 class="font-medium text-gray-800 mb-3">建图总结</h3>
                    <div class="grid grid-cols-2 gap-4 text-sm">
                        <div>
                            <p class="text-gray-500">地图名称</p>
                            <p class="font-semibold" id="final-map-name">家庭地图</p>
                        </div>
                        <div>
                            <p class="text-gray-500">建图用时</p>
                            <p class="font-semibold" id="final-mapping-time">18分35秒</p>
                        </div>
                        <div>
                            <p class="text-gray-500">扫描面积</p>
                            <p class="font-semibold" id="final-scanned-area">125㎡</p>
                        </div>
                        <div>
                            <p class="text-gray-500">检测房间</p>
                            <p class="font-semibold" id="final-rooms-count">5个</p>
                        </div>
                        <div>
                            <p class="text-gray-500">充电桩</p>
                            <p class="font-semibold" id="final-charging-stations">1个</p>
                        </div>
                        <div>
                            <p class="text-gray-500">定位点</p>
                            <p class="font-semibold" id="final-waypoints">4个</p>
                        </div>
                        <div>
                            <p class="text-gray-500">停靠点</p>
                            <p class="font-semibold" id="final-parking-spots">3个</p>
                        </div>
                        <div>
                            <p class="text-gray-500">安全设置</p>
                            <p class="font-semibold text-green-600">已完成</p>
                        </div>
                    </div>
                </div>
                
                <!-- 地图预览 -->
                <div class="mb-6">
                    <h3 class="font-medium text-gray-800 mb-3">地图预览</h3>
                    <div class="bg-gray-100 rounded-lg" style="height: 200px;">
                        <canvas id="final-map-preview" class="w-full h-full rounded-lg"></canvas>
                    </div>
                </div>
                
                <!-- 同步状态 -->
                <div class="flex items-center justify-center mb-6 p-3 bg-blue-50 rounded-lg">
                    <div class="w-6 h-6 bg-blue-500 rounded-full flex items-center justify-center mr-3">
                        <i class="fas fa-cloud-upload-alt text-white text-sm"></i>
                    </div>
                    <div class="text-left">
                        <p class="font-medium text-blue-800">云端同步中...</p>
                        <p class="text-sm text-blue-600">正在将地图数据同步到云端</p>
                    </div>
                </div>
                
                <!-- 操作按钮 -->
                <div class="space-y-3">
                    <button id="start-navigation-btn" class="w-full bg-blue-600 text-white py-3 rounded-xl font-medium">
                        <i class="fas fa-route mr-2"></i>
                        开始导航
                    </button>
                    <button id="view-map-details-btn" class="w-full border border-gray-300 text-gray-700 py-3 rounded-xl font-medium">
                        查看地图详情
                    </button>
                    <button id="back-to-management-btn" class="w-full bg-gray-100 text-gray-600 py-3 rounded-xl font-medium">
                        返回地图管理
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 显示电量不足警告模态框
        function showBatteryWarningModal(currentBattery) {
            // 创建模态框HTML
            const modalHTML = `
                <div id="battery-warning-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center">
                    <div class="bg-white rounded-xl shadow-lg p-6 m-4 max-w-sm w-full">
                        <div class="text-center mb-4">
                            <div class="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                <i class="fas fa-battery-quarter text-red-600 text-2xl"></i>
                            </div>
                            <h3 class="text-lg font-semibold text-gray-800 mb-2">⚠️ 轮椅电量不足</h3>
                        </div>
                        
                        <div class="space-y-3 mb-6">
                            <div class="flex justify-between items-center p-3 bg-red-50 rounded-lg">
                                <span class="text-sm text-gray-700">当前电量</span>
                                <span class="text-sm font-bold text-red-600">${currentBattery}%</span>
                            </div>
                            <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                                <span class="text-sm text-gray-700">建图所需电量</span>
                                <span class="text-sm font-bold text-green-600">≥50%</span>
                            </div>
                        </div>
                        
                        <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-6">
                            <div class="flex items-start">
                                <i class="fas fa-exclamation-triangle text-yellow-600 mt-0.5 mr-2"></i>
                                <div class="text-sm text-yellow-800">
                                    <p class="font-medium mb-1">温馨提示</p>
                                    <p>建图过程耗电较大，电量不足可能导致建图失败。请为轮椅充电至50%以上再进行建图操作。</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="flex space-x-3">
                            <button onclick="closeBatteryWarningModal()" class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-700 py-2 px-4 rounded-lg font-medium transition">
                                取消
                            </button>
                            <button onclick="closeBatteryWarningModal()" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded-lg font-medium transition">
                                我知道了
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            // 添加到页面
            document.body.insertAdjacentHTML('beforeend', modalHTML);
            
            // 添加点击外部关闭功能
            const modal = document.getElementById('battery-warning-modal');
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    closeBatteryWarningModal();
                }
            });
        }
        
        // 关闭电量警告模态框
        function closeBatteryWarningModal() {
            const modal = document.getElementById('battery-warning-modal');
            if (modal) {
                modal.remove();
            }
        }

        // 切换页面的简单实现
        document.addEventListener('DOMContentLoaded', function() {
            
            // 电量随机更新系统
            let currentBatteryLevel = 85; // 当前电量百分比
            
            // 生成30%-85%之间的随机电量
            function generateRandomBattery() {
                return Math.floor(Math.random() * (85 - 30 + 1)) + 30;
            }
            
            // 根据电量级别获取电池图标和颜色
            function getBatteryIcon(level) {
                if (level >= 75) return { icon: 'fas fa-battery-full', color: 'text-green-500' };
                if (level >= 50) return { icon: 'fas fa-battery-three-quarters', color: 'text-green-500' };
                if (level >= 25) return { icon: 'fas fa-battery-half', color: 'text-yellow-500' };
                return { icon: 'fas fa-battery-quarter', color: 'text-red-500' };
            }
            
            // 根据电量计算预计时间和里程
            function calculateBatteryInfo(level) {
                const baseHours = 8; // 100%电量的基准使用时间
                const baseKm = 35; // 100%电量的基准里程
                
                const hours = Math.floor((level / 100) * baseHours);
                const minutes = Math.floor(((level / 100) * baseHours - hours) * 60);
                const km = Math.floor((level / 100) * baseKm);
                
                return {
                    timeText: `${hours}小时${minutes}分钟`,
                    distance: km
                };
            }
            
            // 更新所有电量显示
            function updateBatteryDisplay() {
                currentBatteryLevel = generateRandomBattery();
                const batteryInfo = calculateBatteryInfo(currentBatteryLevel);
                const batteryIcon = getBatteryIcon(currentBatteryLevel);
                
                // 更新主界面电量显示
                const batteryPercentage = document.getElementById('battery-percentage');
                if (batteryPercentage) {
                    batteryPercentage.textContent = `${currentBatteryLevel}%`;
                }
                
                // 更新电池图标
                const batteryIconElement = document.getElementById('battery-icon');
                if (batteryIconElement) {
                    batteryIconElement.className = `${batteryIcon.icon} ${batteryIcon.color} mb-1 block`;
                }
                
                // 更新语音助手对话中的电量信息
                const batteryStatusText = document.getElementById('battery-status-text');
                if (batteryStatusText) {
                    batteryStatusText.textContent = `您的轮椅当前电量为${currentBatteryLevel}%，预计可以使用${batteryInfo.timeText}，行驶距离约${batteryInfo.distance}公里。`;
                }
                
                // 更新历史对话中的电量信息
                const batteryHistoryText = document.getElementById('battery-history-text');
                if (batteryHistoryText) {
                    batteryHistoryText.textContent = `您的轮椅当前电量为${currentBatteryLevel}%，预计可以使用${batteryInfo.timeText}，行驶距离约${batteryInfo.distance}公里。`;
                }
                
                // 建图小贴士保持静态内容，电量状态由按钮显示
                
                // 更新新建地图按钮状态
                const createNewMapBtn = document.getElementById('create-new-map-btn');
                if (createNewMapBtn) {
                    if (currentBatteryLevel < 50) {
                        // 电量不足时禁用按钮
                        createNewMapBtn.disabled = true;
                        createNewMapBtn.className = 'w-full bg-gray-400 text-gray-600 py-3 rounded-xl font-medium flex items-center justify-center mb-4 cursor-not-allowed';
                        createNewMapBtn.innerHTML = `
                            <i class="fas fa-battery-quarter mr-2"></i>
                            电量不足，无法建图 (${currentBatteryLevel}%)
                        `;
                    } else {
                        // 电量充足时恢复按钮
                        createNewMapBtn.disabled = false;
                        createNewMapBtn.className = 'w-full bg-blue-600 hover:bg-blue-700 text-white py-3 rounded-xl font-medium flex items-center justify-center mb-4';
                        createNewMapBtn.innerHTML = `
                            <i class="fas fa-plus mr-2"></i>
                            新建地图
                        `;
                    }
                }
                
                // 更新全局电量状态（用于动态生成的内容）
                window.currentBatteryStatus = {
                    level: currentBatteryLevel,
                    timeText: batteryInfo.timeText,
                    distance: batteryInfo.distance,
                    fullText: `您的轮椅当前电量为${currentBatteryLevel}%，预计可以使用${batteryInfo.timeText}，行驶距离约${batteryInfo.distance}公里。轮椅整体状态良好，无异常故障。`
                };
                
                console.log(`🔋 电量已更新: ${currentBatteryLevel}% (${batteryInfo.timeText}, ${batteryInfo.distance}km)`);
            }
            
            // 启动电量随机更新定时器
            function startBatteryUpdater() {
                // 立即执行一次
                updateBatteryDisplay();
                
                // 每10秒更新一次
                setInterval(updateBatteryDisplay, 10000);
            }
            
            // 启动电量更新系统
            startBatteryUpdater();
            
            // 登录注册表单切换
            const showLoginBtn = document.getElementById('show-login-btn');
            const showRegisterBtn = document.getElementById('show-register-btn');
            const loginForm = document.getElementById('login-form');
            const registerForm = document.getElementById('register-form');
            
            if (showLoginBtn && showRegisterBtn && loginForm && registerForm) {
                showLoginBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    registerForm.classList.add('hidden');
                    loginForm.classList.remove('hidden');
                });
                
                showRegisterBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    loginForm.classList.add('hidden');
                    registerForm.classList.remove('hidden');
                });
            }
            
            // 导航栏切换
            const navLinks = document.querySelectorAll('nav a');
            navLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // 移除所有页面的active状态
                    navLinks.forEach(l => l.classList.remove('text-blue-500'));
                    navLinks.forEach(l => l.classList.add('text-gray-400'));
                    
                    // 设置当前页面为active
                    this.classList.remove('text-gray-400');
                    this.classList.add('text-blue-500');
                    
                    // 隐藏所有页面
                    const allPages = [
                        'login', 'add-device', 'wifi-setup', 'device-success', 'control', 
                        'device-status', 'profile', 'voice', 'map-management', 'create-map-check',
                        'map-naming', 'environment-check', 'mapping-precautions', 'real-time-mapping',
                        'set-charging-station', 'set-waypoints', 'set-parking-spots', 'set-safety-zones',
                        'set-restricted-zones', 'mapping-complete'
                    ];
                    
                    allPages.forEach(pageId => {
                        const page = document.getElementById(pageId);
                        if (page) {
                            page.classList.add('hidden');
                        }
                    });
                    
                    // 显示对应页面
                    const target = this.getAttribute('href').substring(1);
                    if (target === 'home') {
                        document.getElementById('login').classList.remove('hidden');
                    } else if (target === 'control') {
                        document.getElementById('control').classList.remove('hidden');
                    } else if (target === 'device') {
                        document.getElementById('device-status').classList.remove('hidden');
                    } else if (target === 'profile') {
                        document.getElementById('profile').classList.remove('hidden');
                    } else if (target === 'voice') {
                        document.getElementById('voice').classList.remove('hidden');
                    }
                });
            });
            
            // 添加设备按钮事件处理
            const addDeviceBtn = document.getElementById('add-device-btn');
            if (addDeviceBtn) {
                addDeviceBtn.addEventListener('click', function() {
                    // 隐藏设备状态页面
                    document.getElementById('device-status').classList.add('hidden');
                    // 显示添加设备页面
                    document.getElementById('add-device').classList.remove('hidden');
                });
            }

            // 添加设备页面返回按钮
            const deviceBackBtn = document.createElement('button');
            deviceBackBtn.className = 'absolute top-4 left-4 text-gray-600';
            deviceBackBtn.innerHTML = '<i class="fas fa-arrow-left"></i>';
            deviceBackBtn.addEventListener('click', function() {
                // 隐藏添加设备页面
                document.getElementById('add-device').classList.add('hidden');
                // 显示设备状态页面
                document.getElementById('device-status').classList.remove('hidden');
            });
            
            // 添加返回按钮到添加设备页面
            const addDevicePage = document.getElementById('add-device');
            if (addDevicePage && !addDevicePage.querySelector('.back-btn')) {
                addDevicePage.style.position = 'relative';
                addDevicePage.appendChild(deviceBackBtn);
            }
            
            // 连接设备按钮事件
            const connectDeviceBtn = document.getElementById('connect-device-btn');
            if (connectDeviceBtn) {
                connectDeviceBtn.addEventListener('click', function() {
                    // 隐藏添加设备页面
                    document.getElementById('add-device').classList.add('hidden');
                    // 显示WiFi设置页面
                    document.getElementById('wifi-setup').classList.remove('hidden');
                    
                    // 添加返回按钮到WiFi设置页面
                    const wifiSetupPage = document.getElementById('wifi-setup');
                    if (wifiSetupPage && !wifiSetupPage.querySelector('.back-btn')) {
                        const wifiBackBtn = document.createElement('button');
                        wifiBackBtn.className = 'absolute top-4 left-4 text-gray-600 back-btn';
                        wifiBackBtn.innerHTML = '<i class="fas fa-arrow-left"></i>';
                        wifiBackBtn.addEventListener('click', function() {
                            // 隐藏WiFi设置页面
                            document.getElementById('wifi-setup').classList.add('hidden');
                            // 显示添加设备页面
                            document.getElementById('add-device').classList.remove('hidden');
                        });
                        wifiSetupPage.style.position = 'relative';
                        wifiSetupPage.appendChild(wifiBackBtn);
                    }
                });
            }
            
            // 刷新设备列表按钮事件
            const refreshDevicesBtn = document.getElementById('refresh-devices-btn');
            if (refreshDevicesBtn) {
                refreshDevicesBtn.addEventListener('click', function() {
                    // 模拟刷新过程
                    const spinner = document.querySelector('#add-device .animate-spin');
                    if (spinner) {
                        spinner.style.display = 'block';
                        setTimeout(function() {
                            spinner.style.display = 'none';
                            alert('已刷新设备列表');
                        }, 1500);
                    }
                });
            }

            // WiFi配置确认按钮事件
            const confirmWifiBtn = document.getElementById('confirm-wifi-btn');
            if (confirmWifiBtn) {
                confirmWifiBtn.addEventListener('click', function() {
                    // 显示加载动画
                    const loadingEl = document.createElement('div');
                    loadingEl.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
                    loadingEl.innerHTML = '<div class="bg-white p-5 rounded-lg"><div class="animate-spin rounded-full h-10 w-10 border-b-2 border-blue-600 mx-auto mb-3"></div><p class="text-center">正在配置Wi-Fi，请稍候...</p></div>';
                    document.body.appendChild(loadingEl);
                    
                    // 模拟配置过程
                    setTimeout(function() {
                        // 移除加载动画
                        document.body.removeChild(loadingEl);
                        
                        // 隐藏WiFi设置页面
                        document.getElementById('wifi-setup').classList.add('hidden');
                        // 显示设备添加成功页面
                        document.getElementById('device-success').classList.remove('hidden');
                    }, 2000);
                });
            }
            
            // 前往设备状态按钮事件
            const goToDeviceStatusBtn = document.getElementById('go-to-device-status-btn');
            if (goToDeviceStatusBtn) {
                goToDeviceStatusBtn.addEventListener('click', function() {
                    // 隐藏设备添加成功页面
                    document.getElementById('device-success').classList.add('hidden');
                    // 显示设备状态页面
                    document.getElementById('device-status').classList.remove('hidden');
                    
                    // 激活导航栏"设备"选项
                    navLinks.forEach(l => l.classList.remove('text-blue-500'));
                    navLinks.forEach(l => l.classList.add('text-gray-400'));
                    
                    const deviceNavLink = document.querySelector('nav a[href="#device"]');
                    if (deviceNavLink) {
                        deviceNavLink.classList.remove('text-gray-400');
                        deviceNavLink.classList.add('text-blue-500');
                    }
                });
            }

            // 虚拟摇杆简单交互
            const joystick = document.querySelector('.joystick');
            const container = document.querySelector('.joystick-container');
            
            if (joystick && container) {
                let isDragging = false;
                
                joystick.addEventListener('mousedown', function(e) {
                    isDragging = true;
                });
                
                document.addEventListener('mousemove', function(e) {
                    if (!isDragging) return;
                    
                    const containerRect = container.getBoundingClientRect();
                    const centerX = containerRect.left + containerRect.width / 2;
                    const centerY = containerRect.top + containerRect.height / 2;
                    
                    let x = e.clientX - centerX;
                    let y = e.clientY - centerY;
                    
                    // 限制在圆形范围内
                    const radius = containerRect.width / 2 - joystick.offsetWidth / 2;
                    const distance = Math.sqrt(x * x + y * y);
                    
                    if (distance > radius) {
                        x = (x / distance) * radius;
                        y = (y / distance) * radius;
                    }
                    
                    joystick.style.transform = `translate(${x}px, ${y}px)`;
                });
                
                document.addEventListener('mouseup', function() {
                    if (!isDragging) return;
                    isDragging = false;
                    
                    // 回到中心位置
                    joystick.style.transform = 'translate(-50%, -50%)';
                });
            }
            
            // 设备详情模态框控制
            const showDeviceDetailsBtn = document.getElementById('show-device-details-btn');
            const closeDeviceDetailsBtn = document.getElementById('close-device-details-btn');
            const deviceDetailsModal = document.getElementById('device-details-modal');
            
            if (showDeviceDetailsBtn && closeDeviceDetailsBtn && deviceDetailsModal) {
                showDeviceDetailsBtn.addEventListener('click', function() {
                    deviceDetailsModal.classList.remove('hidden');
                });
                
                closeDeviceDetailsBtn.addEventListener('click', function() {
                    deviceDetailsModal.classList.add('hidden');
                });
                
                // 设备详情模态框点击外部关闭
                deviceDetailsModal.addEventListener('click', function(e) {
                    if (e.target === deviceDetailsModal) {
                        deviceDetailsModal.classList.add('hidden');
                    }
                });
            }
            
            // 实时视频相关功能
            const videoElement = document.getElementById('remote-video');
            const videoPlaceholder = document.getElementById('video-placeholder');
            const toggleFullscreen = document.getElementById('toggle-fullscreen');
            const toggleMic = document.getElementById('toggle-mic');
            
            if (videoElement && videoPlaceholder) {
                // 模拟视频加载
                setTimeout(() => {
                    // 通常这里会是真实的视频流，这里用模拟数据
                    const simulatedVideoSource = 'https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ForBiggerJoyrides.mp4';
                    
                    videoElement.src = simulatedVideoSource;
                    videoElement.onloadeddata = () => {
                        videoPlaceholder.style.display = 'none';
                    };
                    
                    // 错误处理
                    videoElement.onerror = () => {
                        videoPlaceholder.innerHTML = '<p class="text-gray-400 text-sm">视频加载失败，请检查网络连接</p>';
                    };
                }, 2000);
            }
            
            // 全屏切换
            if (toggleFullscreen) {
                toggleFullscreen.addEventListener('click', () => {
                    if (!document.fullscreenElement) {
                        if (videoElement.requestFullscreen) {
                            videoElement.requestFullscreen();
                        } else if (videoElement.webkitRequestFullscreen) {
                            videoElement.webkitRequestFullscreen();
                        } else if (videoElement.msRequestFullscreen) {
                            videoElement.msRequestFullscreen();
                        }
                        toggleFullscreen.innerHTML = '<i class="fas fa-compress"></i>';
                    } else {
                        if (document.exitFullscreen) {
                            document.exitFullscreen();
                        } else if (document.webkitExitFullscreen) {
                            document.webkitExitFullscreen();
                        } else if (document.msExitFullscreen) {
                            document.msExitFullscreen();
                        }
                        toggleFullscreen.innerHTML = '<i class="fas fa-expand"></i>';
                    }
                });
                
                // 监听全屏变化
                document.addEventListener('fullscreenchange', () => {
                    if (!document.fullscreenElement) {
                        toggleFullscreen.innerHTML = '<i class="fas fa-expand"></i>';
                    }
                });
            }
            
            // 麦克风切换（模拟功能）
            let micEnabled = false;
            if (toggleMic) {
                toggleMic.addEventListener('click', () => {
                    micEnabled = !micEnabled;
                    if (micEnabled) {
                        toggleMic.innerHTML = '<i class="fas fa-microphone"></i>';
                        // 这里应该启用麦克风
                    } else {
                        toggleMic.innerHTML = '<i class="fas fa-microphone-slash"></i>';
                        // 这里应该禁用麦克风
                    }
                });
            }

            // 档位调节功能
            const decreaseLevelBtn = document.getElementById('decrease-level');
            const increaseLevelBtn = document.getElementById('increase-level');
            const levelIndicator = document.getElementById('level-indicator');
            const currentSpeedDisplay = document.getElementById('current-speed');
            
            // 档位与速度对应表
            const speedLevels = {
                1: {width: '20%', speed: '1.0 km/h'},
                2: {width: '40%', speed: '1.8 km/h'},
                3: {width: '60%', speed: '2.5 km/h'}, // 默认值
                4: {width: '80%', speed: '3.2 km/h'},
                5: {width: '100%', speed: '4.0 km/h'}
            };
            
            // 当前档位
            let currentLevel = 3;
            
            // 更新档位显示和车速
            function updateSpeedLevel() {
                if (levelIndicator && currentSpeedDisplay) {
                    const levelData = speedLevels[currentLevel];
                    levelIndicator.style.width = levelData.width;
                    currentSpeedDisplay.textContent = levelData.speed;
                    
                    // 更新档位数字显示
                    const levelTexts = document.querySelectorAll('.flex.justify-between.mt-1 .text-xs');
                    levelTexts.forEach((text, index) => {
                        const level = index + 1;
                        if (level === currentLevel) {
                            text.classList.add('font-bold', 'text-blue-600');
                        } else {
                            text.classList.remove('font-bold', 'text-blue-600');
                        }
                    });
                }
            }
            
            // 绑定按钮事件
            if (decreaseLevelBtn && increaseLevelBtn) {
                decreaseLevelBtn.addEventListener('click', () => {
                    if (currentLevel > 1) {
                        currentLevel--;
                        updateSpeedLevel();
                    }
                });
                
                increaseLevelBtn.addEventListener('click', () => {
                    if (currentLevel < 5) {
                        currentLevel++;
                        updateSpeedLevel();
                    }
                });
                
                // 初始化显示
                updateSpeedLevel();
            }

            // 语音交互相关代码
            const sendTextBtn = document.getElementById('send-text-btn');
            const voiceBtn = document.getElementById('voice-btn');
            const voiceInput = document.getElementById('voice-input');
            const voiceIndicator = document.getElementById('voice-indicator');
            const voiceText = document.getElementById('voice-text');
            const conversationContainer = document.getElementById('conversation-container');
            const voiceCommandBtns = document.querySelectorAll('.voice-command-btn');
            const moreCommandsBtn = document.getElementById('more-commands-btn');
            const moreCommands = document.getElementById('more-commands');
            
            let isListening = false;
            
            // 更多指令展开/收起功能
            if (moreCommandsBtn && moreCommands) {
                moreCommandsBtn.addEventListener('click', function() {
                    moreCommands.classList.toggle('hidden');
                    moreCommands.classList.toggle('expanded');
                    this.classList.toggle('expanded');
                    
                    // 更新按钮文本
                    const btnText = this.querySelector('span');
                    if (btnText) {
                        btnText.textContent = moreCommands.classList.contains('expanded') ? '收起指令' : '更多指令';
                    }
                });
            }
            
            // 发送文本消息
            if (sendTextBtn && voiceInput && conversationContainer) {
                sendTextBtn.addEventListener('click', function() {
                    sendMessage();
                });
                
                voiceInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        sendMessage();
                    }
                });
            }
            
            // 语音按钮交互
            if (voiceBtn && voiceIndicator) {
                voiceBtn.addEventListener('mousedown', function() {
                    startVoiceRecognition();
                });
                
                voiceBtn.addEventListener('mouseup', function() {
                    stopVoiceRecognition();
                });
                
                // 移动设备触摸支持
                voiceBtn.addEventListener('touchstart', function(e) {
                    e.preventDefault();
                    startVoiceRecognition();
                });
                
                voiceBtn.addEventListener('touchend', function() {
                    stopVoiceRecognition();
                });
            }
            
            // 常用指令按钮
            if (voiceCommandBtns) {
                voiceCommandBtns.forEach(btn => {
                    btn.addEventListener('click', function() {
                        // 获取指令文本
                        const command = this.querySelector('.font-medium').textContent;
                        // 填入输入框
                        if (voiceInput) {
                            voiceInput.value = command;
                        }
                        // 自动发送
                        sendMessage();
                    });
                });
            }
            
            // 开始语音识别
            function startVoiceRecognition() {
                if (isListening) return;
                
                isListening = true;
                
                // 显示语音指示器，隐藏输入框
                if (voiceIndicator) {
                    voiceIndicator.classList.remove('hidden');
                    
                    // 模拟音量变化的动画效果
                    const animateVoiceWave = () => {
                        if (!isListening) return;
                        
                        const waveSpans = document.querySelectorAll('.voice-wave span');
                        if (waveSpans.length > 0) {
                            // 随机生成高度变化
                            waveSpans.forEach(span => {
                                const randomHeight = 6 + Math.random() * 20;
                                span.style.height = `${randomHeight}px`;
                            });
                        }
                        
                        // 继续动画循环
                        if (isListening) {
                            requestAnimationFrame(animateVoiceWave);
                        }
                    };
                    
                    // 启动动画
                    requestAnimationFrame(animateVoiceWave);
                }
                
                // 模拟语音识别过程
                if (voiceText) {
                    voiceText.textContent = "正在听取您的指令...";
                    
                    // 随机模拟不同的语音指令
                    const possibleCommands = [
                        "调整到3档速度",
                        "轮椅状态如何",
                        "设置座椅温度为26度",
                        "锁定轮椅",
                        "帮我寻找轮椅位置"
                    ];
                    
                    // 随机选择一条命令
                    const randomCommand = possibleCommands[Math.floor(Math.random() * possibleCommands.length)];
                    
                    // 模拟识别过程 - 逐字显示
                    const showTextGradually = (text) => {
                        let currentText = "";
                        let index = 0;
                        
                        const textInterval = setInterval(() => {
                            if (index >= text.length || !isListening) {
                                clearInterval(textInterval);
                                return;
                            }
                            
                            currentText += text[index++];
                            voiceText.textContent = currentText;
                        }, 100);
                    };
                    
                    // 延迟后开始逐字显示
                    setTimeout(() => {
                        if (isListening) {
                            showTextGradually(randomCommand);
                        }
                    }, 1000);
                }
            }
            
            // 停止语音识别
            function stopVoiceRecognition() {
                if (!isListening) return;
                
                isListening = false;
                
                // 隐藏语音指示器
                if (voiceIndicator) {
                    voiceIndicator.classList.add('hidden');
                }
                
                // 获取识别的文本并放入输入框
                if (voiceText && voiceInput) {
                    const recognizedText = voiceText.textContent;
                    if (recognizedText && recognizedText !== "正在听取您的指令..." && recognizedText !== "请开始说话") {
                        voiceInput.value = recognizedText;
                        // 自动发送识别的消息
                        sendMessage();
                    }
                    
                    // 重置语音文本
                    voiceText.textContent = "请开始说话";
                }
            }
            
            // 发送消息函数
            function sendMessage() {
                if (!voiceInput || !conversationContainer) return;
                
                const message = voiceInput.value.trim();
                if (!message) return;
                
                // 添加用户消息到对话区
                addMessageToConversation(message, 'user');
                
                // 清空输入框
                voiceInput.value = "";
                
                // 显示正在输入指示
                const typingIndicator = document.createElement('div');
                typingIndicator.className = 'flex items-start my-4 typing-indicator';
                typingIndicator.innerHTML = `
                    <div class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center mr-2 flex-shrink-0">
                        <i class="fas fa-robot text-blue-600"></i>
                    </div>
                    <div class="bg-gray-100 rounded-2xl rounded-tl-none p-3 max-w-[80%]">
                        <div class="typing-dots">
                            <span></span>
                            <span></span>
                            <span></span>
                        </div>
                    </div>
                `;
                conversationContainer.querySelector('.space-y-4').appendChild(typingIndicator);
                scrollToBottom();
                
                // 模拟AI回复
                setTimeout(() => {
                    // 移除"正在输入"指示器
                    const typingEl = document.querySelector('.typing-indicator');
                    if (typingEl) {
                        typingEl.remove();
                    }
                    
                    let response;
                    
                    // 增强的回复逻辑
                    if (message.includes('电量') || message.includes('轮椅状态')) {
                        // 使用动态电量信息
                        response = window.currentBatteryStatus ? window.currentBatteryStatus.fullText : "您的轮椅当前电量为85%，预计可以使用6小时30分钟，行驶距离约25公里。轮椅整体状态良好，无异常故障。";
                    } else if (message.includes('速度') || message.includes('档位')) {
                        const level = message.match(/\d+/);
                        const speedLevel = level ? level[0] : 3;
                        const speedMap = {
                            "1": "1.5km/h",
                            "2": "2.0km/h",
                            "3": "2.5km/h",
                            "4": "3.0km/h",
                            "5": "3.5km/h"
                        };
                        const speed = speedMap[speedLevel] || "2.5km/h";
                        
                        response = `已将速度调整为${speedLevel}档，当前速度${speed}。您可以通过语音指令或控制面板随时调整速度。`;
                        
                        // 同步更新控制页面的档位
                        const speedLevelDisplay = document.getElementById('speed-level-display');
                        if (speedLevelDisplay) {
                            speedLevelDisplay.textContent = speedLevel;
                            // 更新当前速度显示
                            const speedDisplay = document.getElementById('current-speed');
                            if (speedDisplay) {
                                speedDisplay.textContent = speed;
                            }
                        }
                    } else if (message.includes('温度')) {
                        const temp = message.match(/\d+/);
                        const temperature = temp ? temp[0] : 26;
                        response = `座椅温度已设置为${temperature}℃，已切换到舒适模式。您可以随时调整温度或更改加热模式。`;
                    } else if (message.includes('寻找') || message.includes('位置')) {
                        response = "您的轮椅当前位于家中客厅区域。我已在地图上标记位置并可导航前往。轮椅离您约15米远。";
                    } else if (message.includes('锁定')) {
                        response = "已远程锁定轮椅。轮椅现在无法移动，所有物理控制器已暂时禁用。您可以随时通过语音指令解锁轮椅。";
                        
                        // 同步更新控制页面的锁定状态
                        const lockBtn = document.getElementById('lock-btn');
                        if (lockBtn) {
                            lockBtn.classList.remove('bg-blue-600');
                            lockBtn.classList.add('bg-red-600');
                            const lockIcon = lockBtn.querySelector('i');
                            if (lockIcon) {
                                lockIcon.className = 'fas fa-lock';
                            }
                        }
                    } else if (message.includes('解锁')) {
                        response = "轮椅已解锁。物理控制器已恢复正常，您可以正常使用轮椅了。";
                        
                        // 同步更新控制页面的锁定状态
                        const lockBtn = document.getElementById('lock-btn');
                        if (lockBtn) {
                            lockBtn.classList.remove('bg-red-600');
                            lockBtn.classList.add('bg-blue-600');
                            const lockIcon = lockBtn.querySelector('i');
                            if (lockIcon) {
                                lockIcon.className = 'fas fa-unlock';
                            }
                        }
                    } else if (message.includes('紧急') || message.includes('求助') || message.includes('帮助')) {
                        response = "已发送紧急求助信息给您的紧急联系人。GPS位置信息已同时发送，请保持冷静，联系人将尽快与您取得联系。";
                    } else if (message.includes('导航') || message.includes('去') || message.includes('到')) {
                        let destination = "家";
                        if (message.includes('超市')) destination = "附近超市";
                        if (message.includes('医院')) destination = "最近的医院";
                        if (message.includes('公园')) destination = "社区公园";
                        
                        response = `已启动导航，目的地设置为"${destination}"。导航路线已规划，预计到达时间15分钟，距离约1.2公里。`;
                    } else if (message.includes('音乐') || message.includes('播放')) {
                        let musicType = "轻松";
                        if (message.includes('轻音乐')) musicType = "轻音乐";
                        if (message.includes('流行')) musicType = "流行";
                        if (message.includes('古典')) musicType = "古典";
                        
                        response = `已开始播放${musicType}音乐。您可以通过语音指令调整音量或切换曲目。`;
                    } else {
                        response = "我已收到您的消息，需要我为您做些什么吗？您可以询问轮椅状态、调整速度、设置座椅温度、启动导航或控制音乐播放等。";
                    }
                    
                    // 添加AI回复
                    addMessageToConversation(response, 'assistant');
                    
                    // 滚动到底部
                    scrollToBottom();
                }, 1500);
                
                // 滚动到底部
                scrollToBottom();
            }
            
            // 添加消息到对话区
            function addMessageToConversation(text, sender) {
                if (!conversationContainer) return;
                
                const messageDiv = document.createElement('div');
                
                if (sender === 'user') {
                    messageDiv.className = 'flex items-start justify-end my-4';
                    messageDiv.innerHTML = `
                        <div class="bg-blue-500 text-white rounded-2xl rounded-tr-none p-3 max-w-[80%]">
                            <p class="text-sm">${text}</p>
                        </div>
                        <div class="w-8 h-8 bg-gray-200 rounded-full flex items-center justify-center ml-2 flex-shrink-0">
                            <i class="fas fa-user text-gray-500"></i>
                        </div>
                    `;
                } else {
                    messageDiv.className = 'flex items-start my-4';
                    messageDiv.innerHTML = `
                        <div class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center mr-2 flex-shrink-0">
                            <i class="fas fa-robot text-blue-600"></i>
                        </div>
                        <div class="bg-gray-100 rounded-2xl rounded-tl-none p-3 max-w-[80%]">
                            <p class="text-sm">${text}</p>
                        </div>
                    `;
                }
                
                conversationContainer.querySelector('.space-y-4').appendChild(messageDiv);
            }
            
            // 滚动到对话底部
            function scrollToBottom() {
                if (conversationContainer) {
                    conversationContainer.scrollTop = conversationContainer.scrollHeight;
                }
            }

            // 历史对话查询功能
            const historyBtn = document.getElementById('history-btn');
            const historyModal = document.getElementById('history-modal');
            const closeHistoryBtn = document.getElementById('close-history-btn');
            
            if (historyBtn && historyModal && closeHistoryBtn) {
                historyBtn.addEventListener('click', function() {
                    historyModal.classList.remove('hidden');
                });
                
                closeHistoryBtn.addEventListener('click', function() {
                    historyModal.classList.add('hidden');
                });
                
                // 点击弹窗外部关闭
                historyModal.addEventListener('click', function(e) {
                    if (e.target === historyModal) {
                        historyModal.classList.add('hidden');
                    }
                });
                
                // 阻止弹窗内部点击事件冒泡
                const historyModalContent = historyModal.querySelector('.bg-white');
                if (historyModalContent) {
                    historyModalContent.addEventListener('click', function(e) {
                        e.stopPropagation();
                    });
                }
                
                // 历史记录项点击事件
                const historyItems = historyModal.querySelectorAll('.bg-gray-50');
                historyItems.forEach(item => {
                    item.addEventListener('click', function() {
                        // 获取对话内容
                        const dialogTitle = this.querySelector('.font-medium').textContent;
                        const dialogContent = this.querySelector('.text-gray-500.truncate').textContent;
                        
                        // 这里可以实现加载历史对话到当前会话的功能
                        console.log('加载历史对话:', dialogTitle, dialogContent);
                        
                        // 关闭弹窗
                        historyModal.classList.add('hidden');
                        
                        // 可以添加一个提示，告知用户已加载历史对话
                        alert('已加载历史对话: ' + dialogTitle);
                    });
                });
            }
            
            // 地图管理按钮事件处理
            const mapManagementBtn = document.getElementById('map-management-btn');
            if (mapManagementBtn) {
                mapManagementBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    showPage('map-management');
                });
            }
            
            // 设备位置地图相关功能
            function initDeviceLocationMap() {
                // 获取地图相关元素
                const mapElement = document.getElementById('device-location-map');
                const zoomInBtn = document.getElementById('map-zoom-in');
                const zoomOutBtn = document.getElementById('map-zoom-out');
                const navigateBtn = document.getElementById('navigate-btn');
                const deviceAddress = document.getElementById('device-address');
                const locationUpdateTime = document.getElementById('location-update-time');
                const gpsAccuracy = document.getElementById('gps-accuracy');
                
                if (!mapElement) return;
                
                // 模拟不同的位置数据
                const locationData = [
                    {
                        lat: 31.2304,
                        lng: 121.4737,
                        address: '上海市浦东新区张江高科技园区',
                        accuracy: '5米',
                        time: '10:23'
                    },
                    {
                        lat: 31.2354,
                        lng: 121.4857,
                        address: '上海市浦东新区世纪大道1号',
                        accuracy: '8米',
                        time: '10:45'
                    },
                    {
                        lat: 31.2290,
                        lng: 121.4688,
                        address: '上海市黄浦区人民广场',
                        accuracy: '3米',
                        time: '11:12'
                    }
                ];
                
                // 当前位置索引和缩放级别
                let currentLocationIndex = 0;
                let currentZoomLevel = 15;
                
                // 更新地图显示
                function updateMapDisplay() {
                    const location = locationData[currentLocationIndex];
                    
                    // 更新地图背景图像 (使用Mapbox Static Images API)
                    const mapBackground = mapElement.querySelector('.inset-0.opacity-80');
                    if (mapBackground) {
                        mapBackground.style.backgroundImage = `url('https://api.mapbox.com/styles/v1/mapbox/dark-v10/static/${location.lng},${location.lat},${currentZoomLevel},0/350x150?access_token=pk.eyJ1IjoiZXhhbXBsZXVzZXIiLCJhIjoiY2syMDVtbDZ1MG9hdjNvcGJ2YWUzcHNmcyJ9.f1Y4y9cTZxL-tsjNk3hUbA')`;
                    }
                    
                    // 更新位置信息
                    if (deviceAddress) deviceAddress.textContent = location.address;
                    if (locationUpdateTime) locationUpdateTime.textContent = `更新于: ${location.time}`;
                    if (gpsAccuracy) gpsAccuracy.textContent = `GPS精度: ${location.accuracy}`;
                }
                
                // 初始化地图显示
                updateMapDisplay();
                
                // 定时模拟位置更新
                setInterval(() => {
                    currentLocationIndex = (currentLocationIndex + 1) % locationData.length;
                    updateMapDisplay();
                }, 30000); // 每30秒更新一次位置
                
                // 缩放按钮事件
                if (zoomInBtn) {
                    zoomInBtn.addEventListener('click', () => {
                        if (currentZoomLevel < 19) { // 最大缩放级别
                            currentZoomLevel += 1;
                            updateMapDisplay();
                        }
                    });
                }
                
                if (zoomOutBtn) {
                    zoomOutBtn.addEventListener('click', () => {
                        if (currentZoomLevel > 10) { // 最小缩放级别
                            currentZoomLevel -= 1;
                            updateMapDisplay();
                        }
                    });
                }
                
                // 导航按钮事件
                if (navigateBtn) {
                    navigateBtn.addEventListener('click', () => {
                        const location = locationData[currentLocationIndex];
                        // 在实际应用中，这里可以打开地图应用进行导航
                        alert(`已打开导航至: ${location.address}`);
                    });
                }
            }
            
            // 在页面加载完成后初始化地图
            initDeviceLocationMap();
            
            // 建图功能相关事件处理
            initMappingFunctions();
        });
        
        // 建图功能初始化
        function initMappingFunctions() {
            // 地图管理入口
            const mapManagementBtn = document.getElementById('map-management-btn');
            if (mapManagementBtn) {
                mapManagementBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    showPage('map-management');
                });
            }
            
            // 地图管理页面返回按钮
            const mapManagementBackBtn = document.getElementById('map-management-back-btn');
            if (mapManagementBackBtn) {
                mapManagementBackBtn.addEventListener('click', function() {
                    showPage('profile');
                });
            }
            
            // 新建地图按钮
            const createNewMapBtn = document.getElementById('create-new-map-btn');
            if (createNewMapBtn) {
                createNewMapBtn.addEventListener('click', function() {
                    // 检查电量是否充足
                    const currentBattery = window.currentBatteryStatus ? window.currentBatteryStatus.level : 85;
                    
                    if (currentBattery < 50) {
                        // 电量不足，显示优雅的提示
                        showBatteryWarningModal(currentBattery);
                        return;
                    }
                    
                    // 电量充足，进入建图流程
                    showPage('create-map-check');
                    startConnectionCheck();
                });
            }
            
            // 连接检查页面
            const createMapCheckBackBtn = document.getElementById('create-map-check-back-btn');
            if (createMapCheckBackBtn) {
                createMapCheckBackBtn.addEventListener('click', function() {
                    showPage('map-management');
                });
            }
            
            // 地图命名页面
            const mapNamingBackBtn = document.getElementById('map-naming-back-btn');
            if (mapNamingBackBtn) {
                mapNamingBackBtn.addEventListener('click', function() {
                    showPage('create-map-check');
                });
            }
            
            // 地图命名输入验证
            const mapNameInput = document.getElementById('map-name-input');
            const namingNextBtn = document.getElementById('naming-next-btn');
            if (mapNameInput && namingNextBtn) {
                mapNameInput.addEventListener('input', function() {
                    if (this.value.trim().length > 0) {
                        namingNextBtn.disabled = false;
                        namingNextBtn.classList.remove('bg-gray-400', 'cursor-not-allowed');
                        namingNextBtn.classList.add('bg-blue-600', 'hover:bg-blue-700');
                    } else {
                        namingNextBtn.disabled = true;
                        namingNextBtn.classList.add('bg-gray-400', 'cursor-not-allowed');
                        namingNextBtn.classList.remove('bg-blue-600', 'hover:bg-blue-700');
                    }
                });
                
                namingNextBtn.addEventListener('click', function() {
                    if (!this.disabled) {
                        showPage('environment-check');
                        // 延迟执行环境检测，模拟检测过程
                        setTimeout(() => {
                            if (window.simulateEnvironmentDetection) {
                                window.simulateEnvironmentDetection();
                            }
                        }, 800);
                    }
                });
            }
            

            
            // 面积滑块
            const areaSlider = document.getElementById('area-slider');
            const areaValue = document.getElementById('area-value');
            if (areaSlider && areaValue) {
                areaSlider.addEventListener('input', function() {
                    areaValue.textContent = this.value + '㎡';
                });
            }
            
            // 环境检测页面
            const environmentCheckBackBtn = document.getElementById('environment-check-back-btn');
            const environmentNextBtn = document.getElementById('environment-next-btn');
            if (environmentCheckBackBtn) {
                environmentCheckBackBtn.addEventListener('click', function() {
                    showPage('map-naming');
                });
            }
            
            // 重置环境检测页面状态
            function resetEnvironmentDetection() {
                const indoorConfirm = document.getElementById('indoor-confirm');
                if (indoorConfirm) {
                    const label = indoorConfirm.closest('label');
                    if (label) {
                        // 重置样式
                        label.classList.remove('bg-yellow-50', 'border', 'border-yellow-300', 'rounded-lg', 'p-2');
                        const span = label.querySelector('span');
                        if (span) {
                            span.classList.remove('font-bold', 'text-blue-800');
                            span.textContent = '我确认当前处于室内环境';
                        }
                    }
                }
                
                // 重置检测结果为默认状态
                const detectionResults = document.getElementById('environment-detection-results');
                if (detectionResults) {
                    detectionResults.innerHTML = `
                        <!-- 默认显示室内环境良好 -->
                        <div class="flex items-center justify-between p-3 bg-green-50 border border-green-200 rounded-lg">
                            <div class="flex items-center">
                                <i class="fas fa-home text-green-600 text-lg mr-3"></i>
                                <div>
                                    <h5 class="font-medium text-green-800">室内环境</h5>
                                    <p class="text-xs text-green-600">检测到适合建图的室内环境</p>
                                </div>
                            </div>
                            <i class="fas fa-check text-green-600"></i>
                        </div>
                        
                        <div class="flex items-center justify-between p-3 bg-green-50 border border-green-200 rounded-lg">
                            <div class="flex items-center">
                                <i class="fas fa-sun text-green-600 text-lg mr-3"></i>
                                <div>
                                    <h5 class="font-medium text-green-800">光线条件</h5>
                                    <p class="text-xs text-green-600">光线适中，无强烈反射</p>
                                </div>
                            </div>
                            <i class="fas fa-check text-green-600"></i>
                        </div>
                        
                        <div class="flex items-center justify-between p-3 bg-yellow-50 border border-yellow-200 rounded-lg">
                            <div class="flex items-center">
                                <i class="fas fa-volume-down text-yellow-600 text-lg mr-3"></i>
                                <div>
                                    <h5 class="font-medium text-yellow-800">环境噪音</h5>
                                    <p class="text-xs text-yellow-600">环境较为安静，建议降低行驶速度</p>
                                </div>
                            </div>
                            <i class="fas fa-exclamation-triangle text-yellow-600"></i>
                        </div>
                    `;
                }
                
                // 隐藏警告
                const outdoorWarning = document.getElementById('outdoor-warning');
                if (outdoorWarning) {
                    outdoorWarning.classList.add('hidden');
                }
            }
            
            // 模拟环境检测 - 20%概率检测到非室内环境
            function simulateEnvironmentDetection() {
                // 先重置状态
                resetEnvironmentDetection();
                
                const isOutdoorDetected = Math.random() < 0.2; // 20%概率
                const detectionResults = document.getElementById('environment-detection-results');
                const outdoorWarning = document.getElementById('outdoor-warning');
                
                if (isOutdoorDetected && detectionResults && outdoorWarning) {
                    // 显示非室内环境检测结果
                    detectionResults.innerHTML = `
                        <div class="flex items-center justify-between p-3 bg-red-50 border-2 border-red-300 rounded-lg">
                            <div class="flex items-center">
                                <i class="fas fa-tree text-red-600 text-lg mr-3"></i>
                                <div>
                                    <h5 class="font-medium text-red-800">室外环境</h5>
                                    <p class="text-xs text-red-600">检测到可能的室外环境特征</p>
                                </div>
                            </div>
                            <i class="fas fa-exclamation-triangle text-red-600"></i>
                        </div>
                        
                        <div class="flex items-center justify-between p-3 bg-yellow-50 border border-yellow-200 rounded-lg">
                            <div class="flex items-center">
                                <i class="fas fa-sun text-yellow-600 text-lg mr-3"></i>
                                <div>
                                    <h5 class="font-medium text-yellow-800">光线条件</h5>
                                    <p class="text-xs text-yellow-600">光线强烈，可能有自然光干扰</p>
                                </div>
                            </div>
                            <i class="fas fa-exclamation-triangle text-yellow-600"></i>
                        </div>
                        
                        <div class="flex items-center justify-between p-3 bg-green-50 border border-green-200 rounded-lg">
                            <div class="flex items-center">
                                <i class="fas fa-volume-down text-green-600 text-lg mr-3"></i>
                                <div>
                                    <h5 class="font-medium text-green-800">环境噪音</h5>
                                    <p class="text-xs text-green-600">环境噪音正常</p>
                                </div>
                            </div>
                            <i class="fas fa-check text-green-600"></i>
                        </div>
                    `;
                    
                    // 显示警告
                    outdoorWarning.classList.remove('hidden');
                    
                    // 让第一个确认选项更加突出
                    const indoorConfirm = document.getElementById('indoor-confirm');
                    if (indoorConfirm) {
                        const label = indoorConfirm.closest('label');
                        if (label) {
                            label.classList.add('bg-yellow-50', 'border', 'border-yellow-300', 'rounded-lg', 'p-2');
                            const span = label.querySelector('span');
                            if (span) {
                                span.classList.add('font-bold', 'text-blue-800');
                                span.textContent = '⚠️ 我确认当前处于室内环境（重要确认）';
                            }
                        }
                    }
                } else {
                    // 显示正常的室内环境检测结果（已在HTML中默认设置）
                    outdoorWarning.classList.add('hidden');
                }
            }
            
            // 保存模拟环境检测函数供页面切换时调用
            window.simulateEnvironmentDetection = simulateEnvironmentDetection;
            
            // 环境确认复选框
            const environmentCheckboxes = ['indoor-confirm', 'space-confirm', 'obstacle-confirm', 'safety-confirm'];
            environmentCheckboxes.forEach(id => {
                const checkbox = document.getElementById(id);
                if (checkbox) {
                    checkbox.addEventListener('change', function() {
                        const allChecked = environmentCheckboxes.every(checkId => 
                            document.getElementById(checkId)?.checked
                        );
                        
                        if (environmentNextBtn) {
                            if (allChecked) {
                                environmentNextBtn.disabled = false;
                                environmentNextBtn.classList.remove('bg-gray-400', 'cursor-not-allowed');
                                environmentNextBtn.classList.add('bg-blue-600', 'hover:bg-blue-700');
                                environmentNextBtn.textContent = '环境检测通过，继续';
                            } else {
                                environmentNextBtn.disabled = true;
                                environmentNextBtn.classList.add('bg-gray-400', 'cursor-not-allowed');
                                environmentNextBtn.classList.remove('bg-blue-600', 'hover:bg-blue-700');
                                environmentNextBtn.textContent = '请确认所有环境条件';
                            }
                        }
                    });
                }
            });
            
            if (environmentNextBtn) {
                environmentNextBtn.addEventListener('click', function() {
                    if (!this.disabled) {
                        showPage('mapping-precautions');
                    }
                });
            }
            
            // 建图注意事项页面
            const precautionsBackBtn = document.getElementById('precautions-back-btn');
            const precautionsNextBtn = document.getElementById('precautions-next-btn');
            if (precautionsBackBtn) {
                precautionsBackBtn.addEventListener('click', function() {
                    showPage('environment-check');
                });
            }
            
            // 风险确认复选框
            const riskCheckboxes = ['safety-risk-confirm', 'environment-risk-confirm', 'responsibility-confirm'];
            riskCheckboxes.forEach(id => {
                const checkbox = document.getElementById(id);
                if (checkbox) {
                    checkbox.addEventListener('change', function() {
                        const allChecked = riskCheckboxes.every(checkId => 
                            document.getElementById(checkId)?.checked
                        );
                        
                        if (precautionsNextBtn) {
                            if (allChecked) {
                                precautionsNextBtn.disabled = false;
                                precautionsNextBtn.classList.remove('bg-gray-400', 'cursor-not-allowed');
                                precautionsNextBtn.classList.add('bg-blue-600', 'hover:bg-blue-700');
                            } else {
                                precautionsNextBtn.disabled = true;
                                precautionsNextBtn.classList.add('bg-gray-400', 'cursor-not-allowed');
                                precautionsNextBtn.classList.remove('bg-blue-600', 'hover:bg-blue-700');
                            }
                        }
                    });
                }
            });
            
            if (precautionsNextBtn) {
                precautionsNextBtn.addEventListener('click', function() {
                    if (!this.disabled) {
                        showPage('real-time-mapping');
                        startRealTimeMapping();
                    }
                });
            }
            
            // 实时建图页面
            const emergencyStopBtn = document.getElementById('emergency-stop-btn');
            const saveAndContinueBtn = document.getElementById('save-and-continue-btn');
            
            if (emergencyStopBtn) {
                emergencyStopBtn.addEventListener('click', function() {
                    if (confirm('确定要停止建图吗？已扫描的数据将会保存。')) {
                        stopMapping();
                        showPage('set-charging-station');
                    }
                });
            }
            
            if (saveAndContinueBtn) {
                saveAndContinueBtn.addEventListener('click', function() {
                    showPage('set-charging-station');
                });
            }
            
            // 建图速度控制
            const speedBtns = document.querySelectorAll('.speed-btn');
            speedBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    speedBtns.forEach(b => {
                        b.classList.remove('bg-blue-600', 'text-white');
                        b.classList.add('bg-gray-200');
                    });
                    this.classList.remove('bg-gray-200');
                    this.classList.add('bg-blue-600', 'text-white');
                });
            });
            
            // 设置充电桩页面
            initChargingStationPage();
            
            // 设置定位点页面
            initWaypointsPage();
            
            // 设置停靠点页面
            initParkingSpotsPage();
            
            // 设置安全区域页面
            initSafetyZonesPage();
            
            // 设置禁行区页面
            initRestrictedZonesPage();
            
            // 完成建图页面
            initMappingCompletePage();
        }
        
        // 页面切换函数
        function showPage(pageId) {
            // 隐藏所有页面
            const pages = [
                'login', 'add-device', 'wifi-setup', 'device-success', 'control', 
                'device-status', 'profile', 'voice', 'map-management', 'create-map-check',
                'map-naming', 'environment-check', 'mapping-precautions', 'real-time-mapping',
                'set-charging-station', 'set-waypoints', 'set-parking-spots', 'set-safety-zones',
                'set-restricted-zones', 'mapping-complete'
            ];
            
            pages.forEach(page => {
                const element = document.getElementById(page);
                if (element) {
                    element.classList.add('hidden');
                }
            });
            
            // 显示目标页面
            const targetPage = document.getElementById(pageId);
            if (targetPage) {
                targetPage.classList.remove('hidden');
            }
        }
        
        // 开始连接检查
        function startConnectionCheck() {
            const bluetoothStatus = document.getElementById('bluetooth-status');
            const wifiStatus = document.getElementById('wifi-status');
            const sensorStatus = document.getElementById('sensor-status');
            const connectionNextBtn = document.getElementById('connection-next-btn');
            
            // 模拟检查过程
            setTimeout(() => {
                // WiFi连接完成
                if (wifiStatus) {
                    wifiStatus.innerHTML = '<i class="fas fa-check text-white text-sm"></i>';
                    wifiStatus.classList.remove('bg-yellow-500');
                    wifiStatus.classList.add('bg-green-500');
                }
                
                setTimeout(() => {
                    // 传感器检查完成
                    if (sensorStatus) {
                        sensorStatus.innerHTML = '<i class="fas fa-check text-white text-sm"></i>';
                        sensorStatus.classList.remove('bg-gray-300');
                        sensorStatus.classList.add('bg-green-500');
                    }
                    
                    // 启用下一步按钮
                    if (connectionNextBtn) {
                        connectionNextBtn.disabled = false;
                        connectionNextBtn.classList.remove('bg-gray-400', 'cursor-not-allowed');
                        connectionNextBtn.classList.add('bg-blue-600', 'hover:bg-blue-700');
                        connectionNextBtn.textContent = '检查完成，下一步';
                        
                        connectionNextBtn.addEventListener('click', function() {
                            showPage('map-naming');
                        });
                    }
                }, 1500);
            }, 2000);
        }
        
        // 建图须知 -> 设置回充点
        function startRealTimeMapping() {
            showPage('set-charging-home');
            initChargingHomePage();
        }
        
        // 初始化设置回充点页面
        function initChargingHomePage() {
            const backBtn = document.getElementById('charging-home-back-btn');
            const detectBtn = document.getElementById('detect-charging-position-btn');
            const positionStatus = document.getElementById('position-status');
            const positionProgress = document.getElementById('position-progress');
            const detectionResult = document.getElementById('detection-result');
            
            if (backBtn) {
                backBtn.addEventListener('click', () => showPage('mapping-precautions'));
            }
            
            if (detectBtn) {
                detectBtn.addEventListener('click', function() {
                    detectChargingPosition();
                });
            }
            
            function detectChargingPosition() {
                detectBtn.disabled = true;
                detectBtn.textContent = '检测中...';
                positionStatus.textContent = '正在检测位置...';
                
                // 模拟检测过程
                let progress = 0;
                const interval = setInterval(() => {
                    progress += 10;
                    positionProgress.style.width = progress + '%';
                    
                    if (progress >= 100) {
                        clearInterval(interval);
                        
                        // 模拟检测成功
                        setTimeout(() => {
                            positionStatus.textContent = '检测完成';
                            detectionResult.classList.remove('hidden');
                            detectionResult.innerHTML = `
                                <div class="p-4 border border-green-200 rounded-lg bg-green-50">
                                    <div class="flex items-center">
                                        <i class="fas fa-check-circle text-green-600 mr-3"></i>
                                        <div>
                                            <h4 class="font-medium text-green-800">位置检测成功</h4>
                                            <p class="text-sm text-green-700 mt-1">
                                                距离: 1.05m • 角度: 正对 • 红外信号: 强
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            `;
                            
                            detectBtn.disabled = false;
                            detectBtn.textContent = '进入定位点设置';
                            detectBtn.classList.remove('bg-blue-600', 'hover:bg-blue-700');
                            detectBtn.classList.add('bg-green-600', 'hover:bg-green-700');
                            
                            detectBtn.onclick = function() {
                                showPage('set-mapping-waypoints');
                                initMappingWaypointsPage();
                            };
                        }, 1000);
                    }
                }, 200);
            }
        }
        
        // 初始化建图定位点设置页面
        function initMappingWaypointsPage() {
            const backBtn = document.getElementById('mapping-waypoints-back-btn');
            const addBtn = document.getElementById('add-mapping-waypoint-btn');
            const removeBtn = document.getElementById('remove-last-waypoint-btn');
            const completeBtn = document.getElementById('mapping-waypoints-complete-btn');
            const waypointsList = document.getElementById('mapping-waypoints-list');
            const waypointsCount = document.getElementById('mapping-waypoints-count');
            const noWaypointsTip = document.getElementById('no-mapping-waypoints-tip');
            
            let mappingWaypoints = [];
            
            if (backBtn) {
                backBtn.addEventListener('click', () => showPage('set-charging-home'));
            }
            
            if (addBtn) {
                addBtn.addEventListener('click', function() {
                    addMappingWaypoint();
                });
            }
            
            if (removeBtn) {
                removeBtn.addEventListener('click', function() {
                    removeMappingWaypoint();
                });
            }
            
            if (completeBtn) {
                completeBtn.addEventListener('click', function() {
                    showPage('real-time-mapping');
                    initRealTimeMappingPage();
                });
            }
            
            function addMappingWaypoint() {
                const name = prompt('请输入定位点名称 (如：客厅入口、房门口等)：') || `定位点${mappingWaypoints.length + 1}`;
                const waypoint = {
                    id: Date.now(),
                    name: name,
                    position: `位置${mappingWaypoints.length + 1}`,
                    timestamp: new Date().toLocaleTimeString()
                };
                
                mappingWaypoints.push(waypoint);
                updateMappingWaypointsList();
                
                // 模拟定位点设置成功提示
                showSuccessMessage(`定位点"${name}"设置成功`);
            }
            
            function removeMappingWaypoint() {
                if (mappingWaypoints.length > 0) {
                    mappingWaypoints.pop();
                    updateMappingWaypointsList();
                }
            }
            
            function updateMappingWaypointsList() {
                if (waypointsCount) waypointsCount.textContent = `${mappingWaypoints.length}个`;
                
                if (mappingWaypoints.length === 0) {
                    if (noWaypointsTip) noWaypointsTip.classList.remove('hidden');
                    if (removeBtn) removeBtn.disabled = true;
                    if (completeBtn) {
                        completeBtn.disabled = true;
                        completeBtn.classList.add('bg-gray-400', 'cursor-not-allowed');
                        completeBtn.classList.remove('bg-blue-600', 'hover:bg-blue-700');
                    }
                } else {
                    if (noWaypointsTip) noWaypointsTip.classList.add('hidden');
                    if (removeBtn) removeBtn.disabled = false;
                    
                    if (mappingWaypoints.length >= 3) {
                        if (completeBtn) {
                            completeBtn.disabled = false;
                            completeBtn.classList.remove('bg-gray-400', 'cursor-not-allowed');
                            completeBtn.classList.add('bg-blue-600', 'hover:bg-blue-700');
                        }
                    }
                    
                    if (waypointsList) {
                        waypointsList.innerHTML = mappingWaypoints.map((waypoint, index) => `
                            <div class="flex items-center justify-between p-3 bg-blue-50 rounded-lg border border-blue-200">
                                <div class="flex items-center">
                                    <div class="w-8 h-8 bg-blue-500 text-white rounded-full flex items-center justify-center text-sm font-semibold mr-3">
                                        ${index + 1}
                                    </div>
                                    <div>
                                        <p class="text-sm font-medium text-blue-800">${waypoint.name}</p>
                                        <p class="text-xs text-blue-600">${waypoint.position} • ${waypoint.timestamp}</p>
                                    </div>
                                </div>
                                <i class="fas fa-map-marker-alt text-blue-500"></i>
                            </div>
                        `).join('');
                    }
                }
            }
            
            function showSuccessMessage(message) {
                const successDiv = document.createElement('div');
                successDiv.className = 'fixed top-4 left-1/2 transform -translate-x-1/2 bg-green-500 text-white px-4 py-2 rounded-lg shadow-lg z-50';
                successDiv.textContent = message;
                document.body.appendChild(successDiv);
                
                setTimeout(() => {
                    document.body.removeChild(successDiv);
                }, 2000);
            }
        }
        
        // 初始化实时建图页面
        function initRealTimeMappingPage() {
            const progressBar = document.getElementById('mapping-progress-bar');
            const progressText = document.getElementById('mapping-progress-text');
            const elapsedTime = document.getElementById('elapsed-time');
            const remainingTime = document.getElementById('remaining-time');
            const scannedArea = document.getElementById('scanned-area');
            const detectedRooms = document.getElementById('detected-rooms');
            const obstaclesCount = document.getElementById('obstacles-count');
            const canvas = document.getElementById('mapping-canvas');
            const radarLine = document.getElementById('radar-line');
            const wheelchairPosition = document.getElementById('wheelchair-position');
            
            let progress = 15;
            let elapsed = 155; // 秒
            let radarAngle = 0;
            let wheelchairX = 30; // 轮椅位置百分比（从回充点开始）
            let wheelchairY = 30;
            let wheelchairAngle = 0;
            let pathPoints = []; // 轮椅路径点（永久保留用于导航）
            let isWaypointMode = false;
            let currentWaypointType = 'waypoint';
            let parkingSpots = []; // 停靠点列表
            let totalPathLength = 0; // 累计导航路径长度
            let buildingStartTime = Date.now(); // 建图开始时间
            let chargingHomePosition = { x: 30, y: 30 }; // 回充点位置
            let mappingDuration = 3 * 60 * 1000; // 3分钟建图时间
            let finishClickCount = 0; // 建图完成按钮点击次数
            let isReturningHome = false; // 是否正在返回回充点
            let previousWheelchairX = 30; // 记录上一次轮椅X位置，用于计算移动方向
            let previousWheelchairY = 30; // 记录上一次轮椅Y位置，用于计算移动方向
            
            // 将充电桩位置添加为路径起点
            pathPoints.push({x: chargingHomePosition.x, y: chargingHomePosition.y});
            
            // 初始化canvas
            if (canvas) {
                const ctx = canvas.getContext('2d');
                canvas.width = canvas.offsetWidth;
                canvas.height = canvas.offsetHeight;
                
                // 开始绘制动画
                function drawMap() {
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    
                    // 绘制已扫描区域（激光雷达效果）
                    drawScannedAreas(ctx);
                    
                    // 绘制轮椅路径
                    drawWheelchairPath(ctx);
                    
                    // 绘制停靠点
                    drawParkingSpots(ctx);
                    
                    // 绘制回充点
                    drawChargingHome(ctx);
                    
                    requestAnimationFrame(drawMap);
                }
                drawMap();
                
                // 地图交互（预留）
                // canvas.addEventListener('click', function(e) {
                //     // 可用于地图交互功能
                // });
            }
            
            // 激光雷达旋转动画
            const radarInterval = setInterval(() => {
                radarAngle += 6; // 每次旋转6度
                if (radarAngle >= 360) radarAngle = 0;
                
                if (radarLine) {
                    radarLine.style.transform = `translate(-50%, -100%) rotate(${radarAngle}deg)`;
                }
            }, 50);
            
            // 轮椅移动模拟 - 扫地机器人风格
            let pathPhase = 0; // 路径阶段
            let pathStep = 0;  // 当前步骤
            let direction = 1; // 移动方向
            let currentRoom = 0; // 当前扫描房间
            
            // 定义房间扫描区域
            const rooms = [
                { minX: 15, maxX: 75, minY: 15, maxY: 75, name: "主房间" },
                { minX: 75, maxX: 95, minY: 25, maxY: 65, name: "次房间" }
            ];
            
            const wheelchairInterval = setInterval(() => {
                // 检查是否需要返回回充点
                const elapsedTime = Date.now() - buildingStartTime;
                
                if (elapsedTime > mappingDuration && !isReturningHome) {
                    isReturningHome = true;
                    // 显示返回提示
                    showSuccessMessage('建图时间已到，自动返回回充点');
                    // 更新状态提示
                    updateMappingStatus('返回回充点中...');
                }
                
                if (isReturningHome) {
                    // 返回回充点的逻辑
                    const dx = chargingHomePosition.x - wheelchairX;
                    const dy = chargingHomePosition.y - wheelchairY;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    
                    if (distance > 2) {
                        // 计算朝向回充点的角度
                        wheelchairAngle = (Math.atan2(dy, dx) * 180 / Math.PI) % 360;
                        
                        // 向回充点移动
                        const moveSpeed = 0.8;
                        wheelchairX += (dx / distance) * moveSpeed;
                        wheelchairY += (dy / distance) * moveSpeed;
                    } else {
                        // 已到达回充点
                        wheelchairX = chargingHomePosition.x;
                        wheelchairY = chargingHomePosition.y;
                        wheelchairAngle = 180; // 面向充电桩
                        updateMappingStatus('已到达回充点', 'fas fa-home');
                    }
                } else {
                    // 正常建图移动逻辑（扫地机器人风格的弓字形扫描路径）
                    const room = rooms[currentRoom] || rooms[0];
                    const roomWidth = room.maxX - room.minX;
                    const roomHeight = room.maxY - room.minY;
                    
                    if (pathPhase === 0) {
                        // 水平扫描阶段
                        const rowHeight = 8; // 每行间距
                        const currentRow = Math.floor(pathStep / 50);
                        const stepInRow = pathStep % 50;
                        
                        wheelchairY = room.minY + (currentRow * rowHeight);
                        
                        if (currentRow % 2 === 0) {
                            // 偶数行：从左到右
                            wheelchairX = room.minX + (stepInRow / 50) * roomWidth;
                            wheelchairAngle = 90; // 向右
                        } else {
                            // 奇数行：从右到左
                            wheelchairX = room.maxX - (stepInRow / 50) * roomWidth;
                            wheelchairAngle = 270; // 向左
                        }
                        
                        // 检查是否完成当前房间扫描
                        if (wheelchairY > room.maxY - 5) {
                            pathPhase = 1; // 切换到边缘扫描
                            pathStep = 0;
                        }
                        
                    } else if (pathPhase === 1) {
                        // 边缘扫描阶段
                        const perimeter = (roomWidth + roomHeight) * 2;
                        const stepProgress = (pathStep % 200) / 200;
                        
                        if (stepProgress < 0.25) {
                            // 上边
                            wheelchairX = room.minX + (stepProgress * 4) * roomWidth;
                            wheelchairY = room.minY;
                            wheelchairAngle = 90;
                        } else if (stepProgress < 0.5) {
                            // 右边
                            wheelchairX = room.maxX;
                            wheelchairY = room.minY + ((stepProgress - 0.25) * 4) * roomHeight;
                            wheelchairAngle = 180;
                        } else if (stepProgress < 0.75) {
                            // 下边
                            wheelchairX = room.maxX - ((stepProgress - 0.5) * 4) * roomWidth;
                            wheelchairY = room.maxY;
                            wheelchairAngle = 270;
                        } else {
                            // 左边
                            wheelchairX = room.minX;
                            wheelchairY = room.maxY - ((stepProgress - 0.75) * 4) * roomHeight;
                            wheelchairAngle = 0;
                        }
                        
                        // 完成边缘扫描后切换到下个房间或螺旋扫描
                        if (pathStep > 200) {
                            if (currentRoom < rooms.length - 1) {
                                currentRoom++;
                                pathPhase = 0;
                                pathStep = 0;
                            } else {
                                pathPhase = 2; // 螺旋扫描
                                pathStep = 0;
                            }
                        }
                        
                    } else if (pathPhase === 2) {
                        // 螺旋扫描阶段（精细扫描）
                        const centerX = (room.minX + room.maxX) / 2;
                        const centerY = (room.minY + room.maxY) / 2;
                        const maxRadius = Math.min(roomWidth, roomHeight) / 3;
                        const spiralProgress = (pathStep % 300) / 300;
                        const radius = spiralProgress * maxRadius;
                        const angle = spiralProgress * Math.PI * 8; // 4圈螺旋
                        
                        wheelchairX = centerX + Math.cos(angle) * radius;
                        wheelchairY = centerY + Math.sin(angle) * radius;
                        wheelchairAngle = (angle * 180 / Math.PI) % 360;
                        
                        // 螺旋完成后重新开始
                        if (pathStep > 300) {
                            pathPhase = 0;
                            pathStep = 0;
                            currentRoom = 0;
                        }
                    }
                    
                    pathStep++;
                }
                
                // 添加一些随机性，模拟真实的路径调整
                wheelchairX += (Math.random() - 0.5) * 0.5;
                wheelchairY += (Math.random() - 0.5) * 0.5;
                
                // 确保轮椅不会超出边界
                wheelchairX = Math.max(10, Math.min(90, wheelchairX));
                wheelchairY = Math.max(10, Math.min(85, wheelchairY));
                
                // 记录建图路径点（永久保留，用于导航）
                pathPoints.push({x: wheelchairX, y: wheelchairY});
                // 不删除路径点，保留完整的建图路径供后续导航使用
                
                // 计算导航路径总长度
                if (pathPoints.length > 1) {
                    const lastPoint = pathPoints[pathPoints.length - 2];
                    const currentPoint = pathPoints[pathPoints.length - 1];
                    const distance = Math.sqrt(
                        Math.pow(currentPoint.x - lastPoint.x, 2) + 
                        Math.pow(currentPoint.y - lastPoint.y, 2)
                    );
                    totalPathLength += distance * 0.1; // 转换为实际距离（假设比例）
                    
                    // 更新路径长度显示
                    const pathLengthElement = document.getElementById('path-length');
                    if (pathLengthElement) {
                        pathLengthElement.textContent = totalPathLength.toFixed(1) + 'm';
                    }
                }
                
                if (wheelchairPosition) {
                    wheelchairPosition.style.left = wheelchairX + '%';
                    wheelchairPosition.style.top = wheelchairY + '%';
                    wheelchairPosition.style.transform = `translate(-50%, -50%) rotate(${wheelchairAngle}deg)`;
                }
            }, 150); // 稍微慢一点，看清楚路径
            
            // 建图进度更新
            const mappingInterval = setInterval(() => {
                progress += Math.random() * 2;
                elapsed += 5;
                
                if (progress >= 100) {
                    progress = 100;
                    clearInterval(mappingInterval);
                    clearInterval(radarInterval);
                    clearInterval(wheelchairInterval);
                }
                
                // 更新进度条
                if (progressBar) progressBar.style.width = progress + '%';
                if (progressText) progressText.textContent = Math.round(progress) + '%';
                
                // 更新时间
                const minutes = Math.floor(elapsed / 60);
                const seconds = elapsed % 60;
                if (elapsedTime) elapsedTime.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                
                const remaining = Math.max(0, 1200 - elapsed);
                const remainingMinutes = Math.floor(remaining / 60);
                const remainingSeconds = remaining % 60;
                if (remainingTime) remainingTime.textContent = `${remainingMinutes.toString().padStart(2, '0')}:${remainingSeconds.toString().padStart(2, '0')}`;
                
                // 更新扫描数据
                if (scannedArea) scannedArea.textContent = Math.round(progress * 1.25) + '㎡';
                if (detectedRooms) detectedRooms.textContent = Math.min(5, Math.round(progress / 20));
                if (obstaclesCount) obstaclesCount.textContent = Math.round(progress / 12);
                
                // 更新建图时间统计
                const buildingElapsed = Math.floor((Date.now() - buildingStartTime) / 1000);
                const buildingMinutes = Math.floor(buildingElapsed / 60);
                const buildingSeconds = buildingElapsed % 60;
                const buildingTimeElement = document.getElementById('building-time');
                if (buildingTimeElement) {
                    buildingTimeElement.textContent = `${buildingMinutes.toString().padStart(2, '0')}:${buildingSeconds.toString().padStart(2, '0')}`;
                }
                
            }, 2500);
            
            // 绘制已扫描区域
            function drawScannedAreas(ctx) {
                // 绘制房间轮廓
                ctx.strokeStyle = '#9CA3AF';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.rect(50, 30, 200, 120);
                ctx.rect(270, 50, 80, 100);
                ctx.stroke();
                
                // 绘制已扫描的区域（渐变填充）
                const scanProgress = progress / 100;
                const gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
                gradient.addColorStop(0, `rgba(34, 197, 94, ${0.3 * scanProgress})`);
                gradient.addColorStop(1, `rgba(34, 197, 94, ${0.1 * scanProgress})`);
                
                ctx.fillStyle = gradient;
                ctx.beginPath();
                ctx.rect(50, 30, 200 * scanProgress, 120);
                if (scanProgress > 0.6) {
                    ctx.rect(270, 50, 80 * (scanProgress - 0.6) * 2.5, 100);
                }
                ctx.fill();
                
                // 绘制障碍物
                ctx.fillStyle = '#EF4444';
                ctx.fillRect(120, 80, 15, 15);
                ctx.fillRect(180, 60, 10, 30);
                ctx.fillRect(280, 120, 20, 10);
            }
            
            // 绘制轮椅路径
            function drawWheelchairPath(ctx) {
                if (pathPoints.length < 2) return;
                
                ctx.strokeStyle = '#FEF08A';
                ctx.lineWidth = 2;
                ctx.beginPath();
                
                for (let i = 0; i < pathPoints.length; i++) {
                    const point = pathPoints[i];
                    const x = (point.x / 100) * canvas.width;
                    const y = (point.y / 100) * canvas.height;
                    
                    if (i === 0) {
                        ctx.moveTo(x, y);
                    } else {
                        ctx.lineTo(x, y);
                    }
                }
                ctx.stroke();
                
                // 绘制路径点
                ctx.fillStyle = '#FEF08A';
                for (let i = 0; i < pathPoints.length; i += 5) {
                    const point = pathPoints[i];
                    const x = (point.x / 100) * canvas.width;
                    const y = (point.y / 100) * canvas.height;
                    ctx.beginPath();
                    ctx.arc(x, y, 1, 0, 2 * Math.PI);
                    ctx.fill();
                }
            }
            
            // 绘制停靠点
            function drawParkingSpots(ctx) {
                parkingSpots.forEach((spot, index) => {
                    const x = (spot.x / 100) * canvas.width;
                    const y = (spot.y / 100) * canvas.height;
                    
                    // 绘制停靠点
                    ctx.fillStyle = '#A855F7';
                    ctx.beginPath();
                    ctx.arc(x, y, 6, 0, 2 * Math.PI);
                    ctx.fill();
                    
                    // 绘制停靠点编号
                    ctx.fillStyle = '#FFFFFF';
                    ctx.font = '10px Arial';
                    ctx.textAlign = 'center';
                    ctx.fillText((index + 1).toString(), x, y + 3);
                    
                    // 绘制方向指示
                    if (spot.angle !== undefined) {
                        const angleRad = (spot.angle * Math.PI) / 180;
                        const lineLength = 12;
                        const endX = x + Math.cos(angleRad) * lineLength;
                        const endY = y + Math.sin(angleRad) * lineLength;
                        
                        ctx.strokeStyle = '#A855F7';
                        ctx.lineWidth = 2;
                        ctx.beginPath();
                        ctx.moveTo(x, y);
                        ctx.lineTo(endX, endY);
                        ctx.stroke();
                    }
                });
            }
            
            // 绘制回充点
            function drawChargingHome(ctx) {
                const x = (chargingHomePosition.x / 100) * canvas.width;
                const y = (chargingHomePosition.y / 100) * canvas.height;
                
                // 绘制回充点
                ctx.fillStyle = '#10B981';
                ctx.beginPath();
                ctx.arc(x, y, 8, 0, 2 * Math.PI);
                ctx.fill();
                
                // 绘制充电图标
                ctx.fillStyle = '#FFFFFF';
                ctx.font = '12px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('⚡', x, y + 4);
            }
            
            // 添加停靠点
            function addParkingSpot() {
                const spotName = prompt('请输入停靠点名称 (如：床边、沙发边等)：') || `停靠点${parkingSpots.length + 1}`;
                const isSafe = confirm('请确认：停靠点附近环境安全，无尖锐物体或跌落风险？');
                
                if (!isSafe) {
                    alert('请先确保停靠点附近环境安全后再设置');
                    return;
                }
                
                // 计算轮椅当前的移动方向
                let movementAngle = wheelchairAngle;
                if (pathPoints.length >= 2) {
                    const currentPoint = pathPoints[pathPoints.length - 1];
                    const previousPoint = pathPoints[pathPoints.length - 2];
                    const dx = currentPoint.x - previousPoint.x;
                    const dy = currentPoint.y - previousPoint.y;
                    
                    if (dx !== 0 || dy !== 0) {
                        // 根据移动方向计算角度
                        movementAngle = Math.atan2(dy, dx) * (180 / Math.PI);
                        // 确保角度在0-360度范围内
                        if (movementAngle < 0) movementAngle += 360;
                    }
                }
                
                const spot = {
                    id: Date.now(),
                    name: spotName,
                    x: wheelchairX,
                    y: wheelchairY,
                    angle: movementAngle, // 使用移动方向作为停靠点朝向
                    timestamp: new Date().toLocaleTimeString(),
                    isSafe: true
                };
                
                parkingSpots.push(spot);
                updateParkingSpotsList();
                
                // 显示成功提示
                showSuccessMessage(`停靠点"${spotName}"设置成功`);
            }
            
            // 更新停靠点列表
            function updateParkingSpotsList() {
                const spotsList = document.getElementById('parking-spots-list');
                const spotsCount = document.getElementById('parking-spots-count');
                const noSpotsTip = document.getElementById('no-parking-spots-tip');
                
                if (spotsCount) spotsCount.textContent = `${parkingSpots.length}个`;
                
                if (parkingSpots.length === 0) {
                    if (noSpotsTip) noSpotsTip.classList.remove('hidden');
                } else {
                    if (noSpotsTip) noSpotsTip.classList.add('hidden');
                    
                    if (spotsList) {
                        spotsList.innerHTML = parkingSpots.map((spot, index) => `
                            <div class="flex items-center justify-between p-3 bg-purple-50 rounded-lg border border-purple-200">
                                <div class="flex items-center">
                                    <div class="w-8 h-8 bg-purple-500 text-white rounded-full flex items-center justify-center text-sm font-semibold mr-3">
                                        ${index + 1}
                                    </div>
                                    <div>
                                        <p class="text-sm font-medium text-purple-800">${spot.name}</p>
                                        <p class="text-xs text-purple-600">
                                            ${spot.timestamp} • 
                                            <span class="inline-flex items-center">
                                                <i class="fas fa-shield-check mr-1"></i>安全确认
                                            </span>
                                        </p>
                                    </div>
                                </div>
                                <button class="text-red-500 text-sm" onclick="removeParkingSpot(${spot.id})">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        `).join('');
                    }
                }
            }
            
            // 检查轮椅是否回到回充点
            function checkReturnToChargingHome() {
                const distance = Math.sqrt(
                    Math.pow(wheelchairX - chargingHomePosition.x, 2) + 
                    Math.pow(wheelchairY - chargingHomePosition.y, 2)
                );
                
                // 允许5%的误差范围
                return distance <= 5;
            }
            
            // 完成建图
            function finishMapping() {
                finishClickCount++;
                
                // 检查是否真的在回充点或已点击3次
                const isAtChargingHome = checkReturnToChargingHome();
                
                if (!isAtChargingHome && finishClickCount < 3) {
                    const remainingClicks = 3 - finishClickCount;
                    showSuccessMessage(`正在返回回充点... (${finishClickCount}/3)`);
                    
                    // 如果还没有开始返回，则开始返回
                    if (!isReturningHome) {
                        isReturningHome = true;
                        showSuccessMessage('开始返回回充点');
                        updateMappingStatus('返回回充点中...', 'fas fa-home');
                    }
                    
                    // 更新按钮文本
                    const finishBtn = document.getElementById('finish-mapping-btn');
                    if (finishBtn) {
                        finishBtn.innerHTML = `<i class="fas fa-home mr-2"></i>返回回充点 (${finishClickCount}/3)`;
                    }
                    
                    return;
                } else if (finishClickCount >= 3) {
                    // 点击3次后，模拟已回到回充点
                    wheelchairX = chargingHomePosition.x;
                    wheelchairY = chargingHomePosition.y;
                    wheelchairAngle = 180;
                    isReturningHome = true;
                    
                    showSuccessMessage('已模拟回到回充点，建图完成！');
                    updateMappingStatus('建图完成！', 'fas fa-check');
                } else if (isAtChargingHome) {
                    showSuccessMessage('已回到回充点，建图完成！');
                    updateMappingStatus('建图完成！', 'fas fa-check');
                }
                
                // 建图完成，跳转到安全区域设置
                setTimeout(() => {
                    showPage('set-safety-zones');
                    initSafetyZonesPage();
                }, 1500);
            }
            
            function showSuccessMessage(message) {
                const successDiv = document.createElement('div');
                successDiv.className = 'fixed top-4 left-1/2 transform -translate-x-1/2 bg-green-500 text-white px-4 py-2 rounded-lg shadow-lg z-50';
                successDiv.textContent = message;
                document.body.appendChild(successDiv);
                
                setTimeout(() => {
                    document.body.removeChild(successDiv);
                }, 2000);
            }
            
            // 更新地图状态提示
            function updateMappingStatus(message, iconClass = 'fas fa-route') {
                const statusTip = document.getElementById('mapping-status-tip');
                if (statusTip) {
                    statusTip.innerHTML = `<i class="${iconClass} mr-1"></i>${message}`;
                    
                    // 根据状态设置不同颜色
                    statusTip.className = 'absolute top-2 left-2 text-white text-xs rounded-lg p-2';
                    if (message.includes('返回') || message.includes('回充')) {
                        statusTip.classList.add('bg-blue-500', 'bg-opacity-90');
                    } else if (message.includes('完成')) {
                        statusTip.classList.add('bg-green-600', 'bg-opacity-90');
                    } else {
                        statusTip.classList.add('bg-green-500', 'bg-opacity-90');
                    }
                }
            }
            
            // 停靠点设置按钮事件
            const addParkingSpotBtn = document.getElementById('add-parking-spot-btn');
            if (addParkingSpotBtn) {
                addParkingSpotBtn.addEventListener('click', function() {
                    addParkingSpot();
                });
            }
            
            // 建图完成按钮事件
            const finishMappingBtn = document.getElementById('finish-mapping-btn');
            if (finishMappingBtn) {
                finishMappingBtn.addEventListener('click', function() {
                    finishMapping();
                });
            }
            

            
            // 全局删除停靠点函数
            window.removeParkingSpot = function(id) {
                parkingSpots = parkingSpots.filter(spot => spot.id !== id);
                updateParkingSpotsList();
            };
        }
        
        // 停止建图
        function stopMapping() {
            // 这里可以添加停止建图的逻辑
            console.log('建图已停止');
        }
        
        // 初始化充电桩设置页面
        function initChargingStationPage() {
            const backBtn = document.getElementById('charging-station-back-btn');
            const nextBtn = document.getElementById('charging-station-next-btn');
            const canvas = document.getElementById('charging-map-canvas');
            const marker = document.getElementById('charging-station-marker');
            const preview = document.getElementById('charging-station-preview');
            const positionInfo = document.getElementById('charging-position-info');
            const scheduleCheckbox = document.getElementById('auto-charge-schedule');
            const scheduleTime = document.getElementById('schedule-time');
            
            if (backBtn) {
                backBtn.addEventListener('click', () => showPage('real-time-mapping'));
            }
            
            if (nextBtn) {
                nextBtn.addEventListener('click', () => showPage('set-waypoints'));
            }
            
            // 定时充电设置
            if (scheduleCheckbox && scheduleTime) {
                scheduleCheckbox.addEventListener('change', function() {
                    if (this.checked) {
                        scheduleTime.classList.remove('hidden');
                    } else {
                        scheduleTime.classList.add('hidden');
                    }
                });
            }
            
            // 模拟地图点击
            if (canvas) {
                canvas.addEventListener('click', function(e) {
                    const rect = canvas.getBoundingClientRect();
                    const x = e.clientX - rect.left;
                    const y = e.clientY - rect.top;
                    
                    // 显示充电桩标记
                    if (marker) {
                        marker.style.left = x + 'px';
                        marker.style.top = y + 'px';
                        marker.classList.remove('hidden');
                    }
                    
                    // 显示预览信息
                    if (preview && positionInfo) {
                        preview.classList.remove('hidden');
                        positionInfo.textContent = `位置: (${Math.round(x)}, ${Math.round(y)})`;
                    }
                    
                    // 启用下一步按钮
                    if (nextBtn) {
                        nextBtn.disabled = false;
                        nextBtn.classList.remove('bg-gray-400', 'cursor-not-allowed');
                        nextBtn.classList.add('bg-blue-600', 'hover:bg-blue-700');
                        nextBtn.textContent = '设置定位点';
                    }
                });
            }
        }
        
        // 初始化定位点设置页面
        function initWaypointsPage() {
            const backBtn = document.getElementById('waypoints-back-btn');
            const nextBtn = document.getElementById('waypoints-next-btn');
            const canvas = document.getElementById('waypoints-map-canvas');
            const waypointsList = document.getElementById('waypoints-list');
            const waypointsCount = document.getElementById('waypoints-count');
            const quickBtns = document.querySelectorAll('.quick-waypoint-btn');
            
            let waypoints = [];
            
            if (backBtn) {
                backBtn.addEventListener('click', () => showPage('set-charging-station'));
            }
            
            if (nextBtn) {
                nextBtn.addEventListener('click', () => showPage('set-parking-spots'));
            }
            
            // 快速添加按钮
            quickBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    const name = this.dataset.name;
                    addWaypoint(name, Math.random() * 200 + 25, Math.random() * 150 + 25);
                });
            });
            
            // 地图点击添加定位点
            if (canvas) {
                canvas.addEventListener('click', function(e) {
                    const rect = canvas.getBoundingClientRect();
                    const x = e.clientX - rect.left;
                    const y = e.clientY - rect.top;
                    
                    const name = prompt('请输入定位点名称:');
                    if (name) {
                        addWaypoint(name, x, y);
                    }
                });
            }
            
            function addWaypoint(name, x, y) {
                if (waypoints.length >= 8) {
                    alert('最多只能设置8个定位点');
                    return;
                }
                
                waypoints.push({name, x, y});
                updateWaypointsList();
            }
            
            function updateWaypointsList() {
                if (waypointsList && waypointsCount) {
                    waypointsCount.textContent = `${waypoints.length}/8`;
                    
                    waypointsList.innerHTML = waypoints.map((wp, index) => `
                        <div class="flex items-center justify-between p-2 bg-gray-50 rounded-lg">
                            <div class="flex items-center">
                                <div class="w-6 h-6 bg-blue-500 text-white rounded-full flex items-center justify-center text-xs mr-2">
                                    ${index + 1}
                                </div>
                                <span class="text-sm">${wp.name}</span>
                            </div>
                            <button class="text-red-500 text-sm" onclick="removeWaypoint(${index})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    `).join('');
                }
            }
            
            // 全局删除函数
            window.removeWaypoint = function(index) {
                waypoints.splice(index, 1);
                updateWaypointsList();
            };
        }
        
        // 初始化停靠点设置页面
        function initParkingSpotsPage() {
            const backBtn = document.getElementById('parking-spots-back-btn');
            const nextBtn = document.getElementById('parking-spots-next-btn');
            
            if (backBtn) {
                backBtn.addEventListener('click', () => showPage('set-waypoints'));
            }
            
            if (nextBtn) {
                nextBtn.addEventListener('click', () => showPage('set-safety-zones'));
            }
            
            // 停靠点类型按钮
            const parkingTypeBtns = document.querySelectorAll('.parking-type-btn');
            parkingTypeBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    parkingTypeBtns.forEach(b => b.classList.remove('border-purple-500', 'bg-purple-50'));
                    this.classList.add('border-purple-500', 'bg-purple-50');
                });
            });
        }
        
        // 初始化安全区域设置页面
        function initSafetyZonesPage() {
            const backBtn = document.getElementById('safety-zones-back-btn');
            const nextBtn = document.getElementById('safety-zones-next-btn');
            
            if (backBtn) {
                backBtn.addEventListener('click', () => showPage('set-parking-spots'));
            }
            
            if (nextBtn) {
                nextBtn.addEventListener('click', () => showPage('set-restricted-zones'));
            }
            
            // 绘制工具
            const drawRectBtn = document.getElementById('draw-rectangle');
            const drawCircleBtn = document.getElementById('draw-circle');
            const clearZonesBtn = document.getElementById('clear-zones');
            
            if (drawRectBtn) {
                drawRectBtn.addEventListener('click', function() {
                    this.classList.add('bg-green-500');
                    drawCircleBtn?.classList.remove('bg-green-500');
                    drawCircleBtn?.classList.add('bg-gray-500');
                });
            }
            
            if (drawCircleBtn) {
                drawCircleBtn.addEventListener('click', function() {
                    this.classList.add('bg-green-500');
                    drawRectBtn?.classList.remove('bg-green-500');
                    drawRectBtn?.classList.add('bg-gray-500');
                });
            }
            
            if (clearZonesBtn) {
                clearZonesBtn.addEventListener('click', function() {
                    if (confirm('确定要清除所有安全区域吗？')) {
                        // 清除安全区域逻辑
                        const zonesList = document.getElementById('safety-zones-list');
                        const zonesCount = document.getElementById('safety-zones-count');
                        if (zonesList) zonesList.innerHTML = '';
                        if (zonesCount) zonesCount.textContent = '0个';
                    }
                });
            }
        }
        
        // 初始化禁行区设置页面
        function initRestrictedZonesPage() {
            const backBtn = document.getElementById('restricted-zones-back-btn');
            const nextBtn = document.getElementById('restricted-zones-next-btn');
            
            if (backBtn) {
                backBtn.addEventListener('click', () => showPage('set-safety-zones'));
            }
            
            if (nextBtn) {
                nextBtn.addEventListener('click', () => {
                    showPage('mapping-complete');
                    completeMappingProcess();
                });
            }
            
            // 快速添加禁行区按钮
            const restrictedZoneBtns = document.querySelectorAll('.restricted-zone-btn');
            restrictedZoneBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    const type = this.dataset.type;
                    addRestrictedZone(type);
                });
            });
            
            function addRestrictedZone(type) {
                const zonesList = document.getElementById('restricted-zones-list');
                const zonesCount = document.getElementById('restricted-zones-count');
                
                if (zonesList) {
                    const zoneElement = document.createElement('div');
                    zoneElement.className = 'flex items-center justify-between p-2 bg-red-50 rounded-lg border border-red-200';
                    zoneElement.innerHTML = `
                        <div class="flex items-center">
                            <i class="fas fa-ban text-red-600 mr-2"></i>
                            <span class="text-sm">${getZoneTypeName(type)}</span>
                        </div>
                        <button class="text-red-500 text-sm" onclick="this.parentElement.remove(); updateRestrictedZonesCount();">
                            <i class="fas fa-trash"></i>
                        </button>
                    `;
                    zonesList.appendChild(zoneElement);
                    updateRestrictedZonesCount();
                }
            }
            
            function getZoneTypeName(type) {
                const names = {
                    'stairs': '楼梯区域',
                    'kitchen': '厨房操作台',
                    'balcony': '阳台边缘',
                    'bathroom': '浴室淋浴区'
                };
                return names[type] || type;
            }
            
            window.updateRestrictedZonesCount = function() {
                const zonesList = document.getElementById('restricted-zones-list');
                const zonesCount = document.getElementById('restricted-zones-count');
                if (zonesList && zonesCount) {
                    const count = zonesList.children.length;
                    zonesCount.textContent = count + '个';
                }
            };
        }
        
        // 初始化建图完成页面
        function initMappingCompletePage() {
            const startNavigationBtn = document.getElementById('start-navigation-btn');
            const viewMapDetailsBtn = document.getElementById('view-map-details-btn');
            const backToManagementBtn = document.getElementById('back-to-management-btn');
            
            if (startNavigationBtn) {
                startNavigationBtn.addEventListener('click', () => {
                    showPage('control');
                    // 激活导航栏"控制"选项
                    updateNavigation('control');
                });
            }
            
            if (viewMapDetailsBtn) {
                viewMapDetailsBtn.addEventListener('click', () => {
                    alert('地图详情功能开发中...');
                });
            }
            
            if (backToManagementBtn) {
                backToManagementBtn.addEventListener('click', () => {
                    showPage('map-management');
                });
            }
        }
        
        // 完成建图过程
        function completeMappingProcess() {
            // 模拟云端同步过程
            setTimeout(() => {
                const syncStatus = document.querySelector('#mapping-complete .bg-blue-50');
                if (syncStatus) {
                    syncStatus.innerHTML = `
                        <div class="w-6 h-6 bg-green-500 rounded-full flex items-center justify-center mr-3">
                            <i class="fas fa-check text-white text-sm"></i>
                        </div>
                        <div class="text-left">
                            <p class="font-medium text-green-800">同步完成</p>
                            <p class="text-sm text-green-600">地图数据已成功同步到云端</p>
                        </div>
                    `;
                    syncStatus.classList.remove('bg-blue-50');
                    syncStatus.classList.add('bg-green-50');
                }
            }, 3000);
        }
        
        // 更新导航栏状态
        function updateNavigation(activeTab) {
            const navLinks = document.querySelectorAll('nav a');
            navLinks.forEach(link => {
                link.classList.remove('text-blue-500');
                link.classList.add('text-gray-400');
            });
            
            const activeLink = document.querySelector(`nav a[href="#${activeTab}"]`);
            if (activeLink) {
                activeLink.classList.remove('text-gray-400');
                activeLink.classList.add('text-blue-500');
            }
        }
    </script>
</body>
</html> 